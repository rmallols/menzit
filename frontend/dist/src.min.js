/* Minified js files! 2015-03-02 */
"use strict";var menzit=angular.module("menzit",["portal","app","ui.router","templates-main"]);less={env:"development",logLevel:0};var app=angular.module("app",["ngAnimate","ngTagsInput","ngSanitize"]);app.config(["$locationProvider","$stateProvider","$urlRouterProvider",function($locationProvider,$stateProvider,$urlRouterProvider){$locationProvider.html5Mode(!0),$stateProvider.state("app",{templateUrl:"app.html",controller:"AppCtrl",resolve:{userSession:["session",function(session){return session.getSession()}]}}).state("app.categories",{url:"/play",templateUrl:"categories.html",controller:"CategoriesCtrl",pageTitle:"Select a category",data:{groupId:"categories"}}).state("app.test",{url:"/play/:categoryId/test",templateUrl:"test.html",controller:"TestCtrl",pageTitle:"Running a test",data:{groupId:"categories"}}).state("app.review",{url:"/review",templateUrl:"review.html",controller:"ReviewCtrl",pageTitle:"Review tests",resolve:{questions:["http",function(http){return http.get("/rest/incorrectAnswers")}]},data:{groupId:"review"}}).state("app.reviewQuestion",{url:"/review/:questionId",templateUrl:"question.html",controller:"ReviewQuestionCtrl",pageTitle:"Review a test",resolve:{question:["$stateParams","http",function($stateParams,http){return http.get("/rest/tests/"+$stateParams.questionId)}]},data:{groupId:"review"}}).state("app.admin",{url:"/admin",templateUrl:"admin.html",controller:"AdminCtrl"}),$urlRouterProvider.otherwise("/")}]),app.run(["$rootScope","browser",function($rootScope,browser){$rootScope.userAgent=browser.getUA(),$rootScope.$on("$stateChangeSuccess",function(event,toState){$rootScope.pageTitle=toState.pageTitle+" | menzit"})}]);var portal=angular.module("portal",["ui.router"]);portal.config(function($locationProvider,$stateProvider,$urlRouterProvider){$locationProvider.html5Mode(!0),$stateProvider.state("portal",{templateUrl:"portal.html",controller:"PortalCtrl"}).state("portal.home",{url:"/",templateUrl:"home.html",controller:"HomeCtrl",pageTitle:"Home"}).state("portal.howItWorks",{url:"/how-it-works",templateUrl:"howItWorks.html",controller:"HowItWorksCtrl",pageTitle:"How it works"}).state("portal.contact",{url:"/contact",templateUrl:"contact.html",controller:"ContactCtrl",pageTitle:"Contact"}),$urlRouterProvider.otherwise("/")}),menzit.factory("browser",["$window",function($window){function getUA(){var userAgent=$window.navigator.userAgent,browsers={chrome:/chrome/i,safari:/safari/i,firefox:/firefox/i,ie:/internet explorer/i};for(var key in browsers)if(browsers[key].test(userAgent))return key;return"unknown"}return{getUA:getUA}}]),menzit.value("constants",{logoPath:"/src/portal/logo.svg",roles:[{_id:0,name:"Plain user"},{_id:1,name:"Admin user"},{_id:2,name:"Super admin user"}]}),menzit.config(["$httpProvider",function($httpProvider){$httpProvider.interceptors.push(["loading",function(loading){return{request:function(config){return loading.start(),config},response:function(response){return loading.done(),response}}}])}]),menzit.service("http",["$http","$q",function($http,$q){function get(url){var deferred=$q.defer();return $http.get(url).then(function(response){deferred.resolve(response.data)}),deferred.promise}function post(url,data,headers){var deferred=$q.defer();return $http.post(url,data,headers).then(function(response){deferred.resolve(response.data)}),deferred.promise}function put(url,data,headers){var deferred=$q.defer();return $http.put(url,data,headers).then(function(response){deferred.resolve(response.data)}),deferred.promise}function remove(url){var deferred=$q.defer();return $http.delete(url).then(function(response){deferred.resolve(response.data)}),deferred.promise}return{get:get,post:post,put:put,"delete":remove}}]),menzit.service("loading",["$timeout",function($timeout){function start(){NProgress.inc()}function done(){$timeout(function(){NProgress.done()},1e3)}return{start:start,done:done}}]),menzit.directive("login",["$rootScope","session",function($rootScope,session){return{templateUrl:"login.html",scope:{visible:"="},link:function(scope){function onLogin(session){session?($rootScope.$emit("authenticatedUser",session),scope.session=session,scope.visible=!1):window.alert("Incorrect login")}scope.credentials={},scope.login=function(){var userName=scope.credentials.userName,password=scope.credentials.password,remember=scope.credentials.remember;session.login(userName,password,remember).then(onLogin)}}}}]),menzit.service("pubSub",[function(){function publish(eventName,data){PubSub.publish(eventName,data)}function subscribe(eventName,subscribeFn){return PubSub.subscribe(eventName,subscribeFn)}function unsubscribe(subscribeFn){PubSub.unsubscribe(subscribeFn)}return{publish:publish,subscribe:subscribe,unsubscribe:unsubscribe}}]),menzit.service("session",["$q","http","pubSub",function($q,http,pubSub){function login(userName,password,remember){var deferred=$q.defer(),credentials={userName:userName,password:password,remember:remember};return http.post("/rest/login",credentials).then(function(retrievedSession){session=retrievedSession,pubSub.publish("login"),deferred.resolve(retrievedSession)}),deferred.promise}function logout(){var deferred=$q.defer();return http.post("/rest/logout").then(function(){session=void 0,pubSub.publish("logout"),deferred.resolve()}),deferred.promise}function getSession(){var deferred=$q.defer();return session?deferred.resolve(session):http.get("/rest/session/").then(function(retrievedSession){session=retrievedSession,deferred.resolve(session)}),deferred.promise}function isLoggedUser(){return session}function isSuperAdminUser(){return session&&2===session.role}function isAdminUser(){return session&&1===session.role}function isPlainUser(){return isLoggedUser()&&!isSuperAdminUser()&&isPlainUser()}function hasAdminRole(){return isAdminUser()||isSuperAdminUser()}var session;return{login:login,logout:logout,getSession:getSession,isLoggedUser:isLoggedUser,isSuperAdminUser:isSuperAdminUser,isAdminUser:isAdminUser,isPlainUser:isPlainUser,hasAdminRole:hasAdminRole}}]),angular.module("templates-main",["admin.html","categoriesAdmin.html","categoryAdmin.html","testAdmin.html","testsAdmin.html","tenant.html","tenants.html","userAdmin.html","usersAdmin.html","app.html","categories.html","audio.html","autoComplete.html","dialog.html","question.html","upload.html","menu.html","menuPanel.html","testData.html","review.html","results.html","test.html","login.html","index.html","contact.html","home.html","howItWorks.html","portal.html"]),angular.module("admin.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("admin.html",'<div class="admin-view">\n    <div ui-view></div>\n</div>')}]),angular.module("categoriesAdmin.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("categoriesAdmin.html",'<div class="categories-admin-view">\n    <div class="cf">\n        <h1 class="float-left">Manage categories</h1>\n        <div class="float-right">\n            <button class="important" ng-click="add()">Add</button>\n        </div>\n    </div>\n    <div class="category" ng-repeat="category in categories">\n        <div class="float-left">\n            {{category.title}}\n        </div>\n        <div class="float-right">\n            <button>\n                <icon class="up-icon"></icon>\n            </button>\n            <button>\n                <icon class="down-icon"></icon>\n            </button>\n            <button ng-click="edit(category)">Edit</button>\n            <button class="important" ng-click="viewTests(category)">View tests</button>\n            <button class="delete" ng-click="confirmDelete(category)">Delete</button>\n        </div>\n    </div>\n    <div dialog mz-if="categoryToBeDeleted" title="Delete category">\n        <label class="warning">Warning</label><br/>\n        The following category and all the tests attached to it will be deleted<br/><br/>\n        <b>{{categoryToBeDeleted.title}}</b><br/><br/>\n        <button class="delete" ng-click="delete()">Delete</button>\n    </div>\n</div>\n')}]),angular.module("categoryAdmin.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("categoryAdmin.html",'<div class="category-view">\n    <div class="cf">\n        <h1 class="float-left">{{title}}</h1>\n\n        <div class="float-right">\n            <button class="important" ng-click="submit()">Save</button>\n        </div>\n    </div>\n    <div class="cf">\n        <div class="l-1-3 input-label">Name</div>\n        <div class="l-2-3"><input type="text" ng-model="category.title"/></div>\n    </div>\n    <div class="cf">\n        <div class="l-1-2 input-label">Image</div>\n        <div class="l-1-2">\n            <upload ng-model="category.media" on-submit-request="uploadRequestFn"></upload>\n        </div>\n    </div>\n</div>\n')}]),angular.module("testAdmin.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("testAdmin.html",'<div class="test-view">\n    <div class="cf">\n        <h1 class="float-left">{{title}}</h1>\n        <div class="float-right">\n            <button class="important" ng-click="submit()">Save</button>\n        </div>\n    </div>\n    <div class="cf">\n        <div class="test-question cf">\n            <div class="l-row">\n                <div class="l-1-4 input-label">Question</div>\n                <div class="l-3-4"><input type="text" ng-model="test.question.text"/></div>\n            </div>\n            <div class="l-row">\n                <div class="l-1-4 input-label">Image</div>\n                <div class="l-3-4">\n                    <upload ng-model="test.question.media" on-submit-request="uploadQuestionRequestFn"></upload>\n                </div>\n            </div>\n        </div>\n        <div>\n            <div class="test-answer l-1-2 cf" ng-repeat="answer in test.answers"\n                 ng-class="{ \'correct-option\': $parent.correctOptionIndex === $index }">\n                <div class="l-row">\n                    <div class="l-1-4 input-label">Answer {{$index + 1}}</div>\n                    <div class="l-3-4"><input type="text" ng-model="answer.title"/></div>\n                </div>\n                <div class="l-row">\n                    <div class="l-1-4 input-label">Explanation</div>\n                    <div class="l-3-4">\n                        <input type="text" ng-model="answer.explanation"\n                               ng-disabled="$index == $parent.correctOptionIndex"/>\n                    </div>\n                </div>\n                <div class="l-row">\n                    <div class="l-1-4 input-label">Image</div>\n                    <div class="l-3-4">\n                        <upload ng-model="answer.media" on-submit-request="uploadAnswerRequestFns[$index]"></upload>\n                    </div>\n                </div>\n                <div class="l-row select-correct">\n                    <button ng-click="$parent.correctOptionIndex = $index">Mark as correct answer</button>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n')}]),angular.module("testsAdmin.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("testsAdmin.html",'<div class="tests-view">\n    <div class="cf">\n        <h1 class="float-left">Tests for category {{category.title}}</h1>\n\n        <div class="float-right">\n            <button class="important" ng-click="add()">Add</button>\n        </div>\n    </div>\n    <div ng-if="!tests.length" class="msg msg-info">\n        There aren\'t tests on this category yet.\n        Click on the \'Add\' button to attach a new test to it.\n    </div>\n    <div class="test" ng-if="tests.length" ng-repeat="test in tests">\n        <div class="text float-left">\n            <div class="l-1-2" truncate>\n                {{test.question.text}}\n            </div>\n            <div class="l-1-2">\n                <div ng-repeat="answer in test.answers" truncate title="{{answer.title}}"\n                     ng-class="{ correct: answer.isCorrect }"\n                     class="answer l-1-{{test.answers.length}} t{{$index}}">\n                    {{answer.title}}\n                </div>\n            </div>\n        </div>\n        <div class="float-right">\n            <button>\n                <icon class="up-icon"></icon>\n            </button>\n            <button>\n                <icon class="down-icon"></icon>\n            </button>\n            <button ng-click="edit(test)">Edit</button>\n            <button class="delete" ng-click="confirmDelete(test)">Delete</button>\n        </div>\n    </div>\n    <div dialog mz-if="testToBeDeleted" title="Delete test">\n        <label class="warning">Warning</label><br/>\n        The following test will be deleted<br/><br/>\n        <b>{{testToBeDeleted.question.text}}</b><br/><br/>\n        <button class="delete" ng-click="delete()">Delete</button>\n    </div>\n</div>\n')}]),angular.module("tenant.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("tenant.html",'<div class="tenant-view">\n    <div class="cf">\n        <h1 class="float-left">{{title}}</h1>\n        <div class="float-right">\n            <button ng-click="submit()" class="important">Save</button>\n        </div>\n    </div>\n    <div class="cf">\n        <div class="l-1-3 input-label">Name</div>\n        <div class="l-2-3"><input type="text" ng-model="tenant.name"/></div>\n    </div>\n    <div class="cf">\n        <div class="l-1-3 input-label">Categories</div>\n        <div class="l-2-3">\n            <div auto-complete\n                 ng-model="tenant.categories"\n                 endpoint="/rest/categories"\n                 display-property="title">\n             </div>\n        </div>\n    </div>\n    <div class="cf">\n        <div class="l-1-3 input-label">Image</div>\n        <div class="l-2-3">\n            <upload ng-model="tenant.media" on-submit-request="uploadRequestFn"></upload>\n        </div>\n    </div>\n</div>')}]),angular.module("tenants.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("tenants.html",'<div class="tenants-view">\n    <div class="cf">\n        <h1 class="float-left">Manage tenants</h1>\n        <div class="float-right">\n            <button class="important" ng-click="add()">Add</button>\n        </div>\n    </div>\n    <div class="tenant" ng-repeat="tenant in tenants">\n        <div class="float-left">\n            {{tenant.name}}\n        </div>\n        <div class="float-right">\n            <button>\n                <icon class="up-icon"></icon>\n            </button>\n            <button>\n                <icon class="down-icon"></icon>\n            </button>\n            <button ng-click="edit(tenant)">Edit</button>\n            <button class="delete" ng-click="confirmDelete(tenant)">Delete</button>\n        </div>\n    </div>\n    <div dialog mz-if="tenantToBeDeleted" title="Delete tenant">\n        <label class="warning">Warning</label><br/>\n        The following tenants will be deleted<br/><br/>\n        <b>{{tenantToBeDeleted.title}}</b><br/><br/>\n        <button class="delete" ng-click="delete()">Delete</button>\n    </div>\n</div>\n')}]),angular.module("userAdmin.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("userAdmin.html",'<div class="user-view">\n    <div class="l-row">\n        <h1 class="float-left">{{title}}</h1>\n        <div class="float-right">\n            <button class="important" ng-click="submit()">Save</button>\n        </div>\n    </div>\n    <div class="l-1-2">\n        <div class="l-row">\n            <div class="l-1-2 input-label">First name</div>\n            <div class="l-1-2"><input type="text" ng-model="user.firstName"/></div>\n        </div>\n        <div class="l-row">\n            <div class="l-1-2 input-label">Last name</div>\n            <div class="l-1-2"><input type="text" ng-model="user.lastName"/></div>\n        </div>\n        <div class="l-row">\n            <div class="l-1-2 input-label">Username</div>\n            <div class="l-1-2"><input type="text" ng-model="user.userName"/></div>\n        </div>\n        <div class="l-row">\n            <div class="l-1-2 input-label">Password</div>\n            <div class="l-1-2">\n                <a href="#"\n                   ng-show="showForceChangePasswordLink"\n                   ng-click="forceChangePassword()"\n                   class="input-label text-align-left display-inline-block">\n                    Change\n                </a>\n                <input type="password" ng-show="!showForceChangePasswordLink" ng-model="user.password"/>\n            </div>\n        </div>\n        <div class="l-row">\n            <div class="l-1-2 input-label">Role</div>\n            <div class="l-1-2">\n                <select ng-model="user.role" ng-options="role._id as role.name for role in roles"></select>\n            </div>\n        </div>\n        <div class="l-row">\n            <div class="l-1-2 input-label">Tenant</div>\n            <div class="l-1-2">\n                <div auto-complete\n                     ng-model="user.tenantId"\n                     endpoint="/rest/tenants"\n                     display-property="name"\n                     single-selection="true">\n                </div>\n            </div>\n        </div>\n    </div>\n    <div class="l-1-2">\n        <div class="l-row">\n            <div class="l-1-2 input-label">Image</div>\n            <div class="l-1-2">\n                <upload ng-model="user.media" on-submit-request="uploadRequestFn"></upload>\n            </div>\n        </div>\n    </div>\n</div>\n')}]),angular.module("usersAdmin.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("usersAdmin.html",'<div class="users-view">\n    <div class="cf">\n        <h1 class="float-left">Manage users</h1>\n        <div class="float-right">\n            <button class="important" ng-click="add()">Add</button>\n        </div>\n    </div>\n    <div class="user" ng-repeat="user in users">\n        <div class="float-left v-centered">\n            {{user.userName}}\n        </div>\n        <div class="float-right">\n            <button>\n                <icon class="up-icon"></icon>\n            </button>\n            <button>\n                <icon class="down-icon"></icon>\n            </button>\n            <button ng-click="edit(user)">Edit</button>\n            <button class="delete" ng-click="confirmDelete(user)">Delete</button>\n        </div>\n    </div>\n    <div dialog mz-if="userToBeDeleted" title="Delete user">\n        <label class="warning">Warning</label><br/>\n        The following user will be deleted<br/><br/>\n        <b>{{userToBeDeleted.userName}}</b><br/><br/>\n        <button class="delete" ng-click="delete()">Delete</button>\n    </div>\n</div>\n')}]),angular.module("app.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("app.html",'<div ng-class="getPageStyleClasses()">\n    <div menu></div>\n    <div ui-view class="main-content"></div>\n</div>')}]),angular.module("categories.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("categories.html",'<div>\n    <h1>Select a category to play with</h1>\n    <div class="category l-1-3" ng-repeat="category in categories" truncate\n         ng-click="launchTest(category)"\n         ng-style="getBackgroundImageStyle(category)">\n        <div class="title">{{category.title}}</div>\n    </div>\n</div>')}]),angular.module("audio.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("audio.html",'<div class="audio">\n    <button ng-click="play()" class="big audio-button">\n        <icon class="mic-icon"></icon>\n    </button>\n    <audio controls class="audio-player" ng-if="audio">\n        <source ng-src="{{getAudioSrc(audio)}}" type="audio/mp3">\n    </audio>\n</div>')}]),angular.module("autoComplete.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("autoComplete.html",'<tags-input\n        ng-model="tags"\n        display-property="{{displayProperty}}"\n        max-tags="{{maxTags}}"\n        on-tag-added="onTagAdded($tag)"\n        placeholder="{{placeholder}}"\n        ng-class="{ \'single-selection\': singleSelection }">\n    <auto-complete\n        source="source($query)"\n        min-length="1"\n        load-on-down-arrow="true">\n    </auto-complete>\n</tags-input>')}]),angular.module("dialog.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("dialog.html",'<div class="dialog" ng-if="mzIf">\n    <div class="overlay" ng-click="hideDialog()"></div>\n    <div class="dialog-box" centered ng-style="centerBox()">\n        <div class="dialog-box-header">\n            <h2 class="dialog-box-title">{{title}}</h2>\n            <button ng-click="hideDialog()"><icon class="close-icon"></icon></button>\n        </div>\n        <div ng-transclude class="dialog-box-content"></div>\n    </div>\n</div>')}]),angular.module("question.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("question.html",'<div class="question-view">\n    <div class="question"\n         ng-class="getQuestionStyleClasses(question.question)"\n         ng-style="getBackgroundMediaStyle(question.question.media)">\n        {{question.question.text}}\n        <div audio="question.question.text"></div>\n    </div>\n    <div class="answers-container">\n        <div ng-repeat="answer in question.answers"\n             class="answer l-answer-{{question.answers.length}}"\n             ng-class="getAnswerStyleClasses(answer)"\n             ng-style="getBackgroundMediaStyle(answer)"\n             ng-click="setAnswer(question, $index)">\n            <div class="option"><div class="text">{{answerCodes[$index]}}</div></div>\n            <div ng-if="answer.validAssert || answer.invalidAssert" class="assert-mark"\n                ng-class="{ \'has-explanation\': answer.explanation }">\n                <icon ng-class="{ \'ok-icon\': answer.validAssert,  \'fail-icon\': answer.invalidAssert }"></icon>\n            </div>\n            <div class="title">{{answer.title}}</div>\n            <div class="explanation">{{answer.explanation}}</div>\n        </div>\n    </div>\n</div>')}]),angular.module("upload.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("upload.html",'<div class="upload-view cf">\n    <input type="file" file-model="selectedFile"/>\n    <div class="upload-button cf">\n        <div class="upload-button-output" ng-if="(media._id || base64) && !toBeDeleted">\n            <button class="delete-image" ng-click="remove()">\n                <icon class="close-icon"></icon>\n            </button>\n            <img ng-src="/media/{{media._id}}?rnd={{refreshToken}}" ng-if="media._id && !base64" />\n            <img ng-src="{{base64}}" ng-if="base64" />\n        </div>\n    </div>\n</div>')}]),angular.module("menu.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("menu.html",'<div class="menu-view">\n    <div class="menu-tenant">\n        <img class="menu-tenant-logo" ng-src="{{getTenantLogo()}}" />\n    </div>\n    <div ng-include="\'testData.html\'" ng-controller="TestDataCtrl"></div>\n    <menu-panel is-active="isPanelActive"></menu-panel>\n    <button ng-click="showLoginDialog()" ng-if="!session">Login</button>\n    <button ng-click="toggleActiveMenuPanel()" ng-if="session">\n        <icon class="menu-icon"></icon>\n    </button>\n    <login visible="isLoginVisible"></login>\n</div>\n')}]),angular.module("menuPanel.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("menuPanel.html",'<div>\n    <div class="overlay menu-panel-overlay" ng-click="hideMenuPanel()" ng-show="isActive"></div>\n    <div class="menu-panel" ng-class="{ \'is-active\': isActive }">\n        <a ui-sref="app.admin.editUser({ userId: session._id, current: \'current\' })" class="menu-panel-item menu-current-user cf"\n           ng-class="isActiveItem(\'current\')">\n            <img class="menu-current-user-icon menu-panel-item-icon" ng-src="/media/{{session.media._id}}" />\n            <h4 class="menu-panel-item-title">{{getUserName(session)}}</h4>\n        </a>\n        <hr class="menu-panel-separator"/>\n        <a ui-sref="app.categories" class="menu-panel-item cf" ng-class="isActiveItem(\'categories\')">\n            <icon class="play-icon menu-panel-item-icon"></icon>\n            <h4 class="menu-panel-item-title">Play</h4>\n        </a>\n        <a ui-sref="app.review" class="menu-panel-item cf" ng-class="isActiveItem(\'review\')">\n            <icon class="review-icon menu-panel-item-icon"></icon>\n            <h4 class="menu-panel-item-title">Review</h4>\n        </a>\n        <hr class="menu-panel-separator"/>\n        <h5 class="menu-panel-header">Admin</h5>\n        <a ui-sref="app.admin.tenants" class="menu-panel-item cf" ng-class="isActiveItem(\'adminTenants\')">\n            <icon class="settings-general-icon menu-panel-item-icon"></icon>\n            <h4 class="menu-panel-item-title">General</h4>\n        </a>\n        <a ui-sref="app.admin.categories" class="menu-panel-item cf" ng-class="isActiveItem(\'adminTests\')">\n            <icon class="settings-tests-icon menu-panel-item-icon"></icon>\n            <h4 class="menu-panel-item-title">Tests</h4>\n        </a>\n        <a ui-sref="app.admin.users" class="menu-panel-item cf" ng-class="isActiveItem(\'adminUsers\')">\n            <icon class="settings-users-icon menu-panel-item-icon"></icon>\n            <h4 class="menu-panel-item-title">Users</h4>\n        </a>\n        <hr class="menu-panel-separator"/>\n        <a href="#" ng-click="logout()" class="menu-panel-item cf">\n            <icon class="sign-out-icon menu-panel-item-icon"></icon>\n            <h4 class="menu-panel-item-title">Sign out</h4>\n        </a>\n    </div>\n</div>')}]),angular.module("testData.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("testData.html",'<div class="test-data-view" ng-if="testData">\n    <div class="metadata question">\n        <div class="title">Question</div>\n        <div class="value">\n            {{getCurrentQuestion()}} / {{testData.totalQuestions}}\n        </div>\n    </div>\n    <div class="total-progress">\n        <div class="runned-progress" ng-style="setProgressWidth()"></div>\n    </div>\n    <div class="metadata score">\n        <div class="title">Score</div>\n        <div class="value">{{score}}</div>\n    </div>\n</div>')}]),angular.module("review.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("review.html",'<div class="review-view">\n    <h1>Questions to review</h1>\n    <div ng-if="!questions.length" class="msg msg-info">\n        There aren\'t more questions to review\n    </div>\n    <div class="incorrect-answer" ng-repeat="question in questions"\n        ng-click="reviewQuestion(question.question._id)">\n        <div class="l-1-6">\n            {{question.question.question.text}}\n        </div>\n        <div class="l-1-6 incorrect-answer-image" ng-repeat="index in [0,1,2,3]"\n            ng-style="getBackgroundImageStyle(question.question.answers[index])">\n        </div>\n        <div class="l-1-6">\n            {{question.totalIncorrectAnswers}} fails\n        </div>\n    </div>\n</div>')}]),angular.module("results.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("results.html",'<div class="results-view">\n    <div class="current-score">\n        <div class="title">Your score is</div>\n        <div class="value">{{score}}</div>\n    </div>\n    <div class="best-results" ng-if="showBestResults">\n        <h2 class="title">Best results on this test</h2>\n        <div class="scrolling-area">\n            <div class="best-result" ng-repeat="bestResult in bestResults"\n                 ng-class="{ current: isCurrentBestResult(bestResult) }">\n                <div class="position">{{$index + 1}}</div>\n                <div class="userName">{{bestResult.user.userName}}</div>\n                <div class="score">{{bestResult.score}}</div>\n            </div>\n        </div>\n    </div>\n    <div class="actions" ng-if="showBestResults">\n        <button ng-click="repeatTest()" class="important">Repeat again</button>\n        <button ng-click="goToHome()">Go to home</button>\n    </div>\n</div>')}]),angular.module("test.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("test.html",'<div class="test-view">\n    <div class="fade-animation" ng-show="isTestInProgress" ng-controller="QuestionsCtrl"\n         ng-include="\'question.html\'" ng-animate></div>\n    <div class="fade-animation" ng-show="isTestFinished" ng-controller="ResultsCtrl"\n         ng-include="\'results.html\'" ng-animate></div>\n</div>')}]),angular.module("login.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("login.html",'<div dialog title="Login" mz-if="visible" class="login">\n    <form ng-submit="login()">\n        <div class="l-row">\n            <input class="user" ng-model="credentials.userName" type="text"\n                   placeholder="Username" autofocus/>\n        </div>\n        <div class="l-row">\n            <input class="password" ng-model="credentials.password" type="password"\n                   placeholder="Password"/>\n        </div>\n        <div class="l-row">\n            <div class="l-1-2 l-fixed">\n                Remember?\n            </div>\n            <div class="l-1-2 l-fixed">\n                <input class="login-checkbox" ng-model="credentials.remember" type="checkbox" />\n            </div>\n        </div>\n        <div class="l-row">\n            <button class="important">Login</button>\n        </div>\n    </form>\n</div>')}]),angular.module("index.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("index.html",'<html ng-app="menzit" class="ua-{{userAgent}}">\n    <head>\n        <title ng-bind="pageTitle"></title>\n        <meta name="viewport" content="width=device-width" />\n        <link rel="icon" type="image/png" href="/src/common/favicon.png">\n        <script src="/src/loader.js" type="text/javascript"></script>\n    </head>\n    <body>\n        <div ui-view></div>\n    </body>\n\n</html>')}]),angular.module("contact.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("contact.html",'<div class="contact-view">\n    <div class="l-row">\n       <div class="l-1-2">\n           <h2>Contact by email</h2>\n           You can contact us on the following email address:\n           <h2><a href="mailto:hi@menzit.com">hi@menzit.com</a></h2>\n       </div>\n        <div class="l-1-2">\n            <h2>Contact form</h2>\n            <form name="contactForm">\n                <div class="l-row">\n                    <input type="email" ng-model="contactData.email" placeholder="Your email" required />\n                </div>\n                <div class="l-row">\n                    <input type="text" ng-model="contactData.subject" placeholder="What do you need help with?" required />\n                </div>\n                <div class="l-row">\n                    <textarea ng-model="contactData.text" placeholder="Additional info" ></textarea>\n                </div>\n                <div class="l-row">\n                    <button ng-click="contactForm.$valid && submitContact()" class="contact-submit">Submit</button>\n                </div>\n                <div class="l-row">\n                    <div class="msg msg-success" ng-show="success">\n                        Thanks for contacting us!<br/>\n                        We\'ll come back to you ASAP.\n                    </div>\n                    <div class="msg msg-error" ng-show="error">\n                        Ooops...sorry, something went wrong :(<br/>\n                        Plase contact us on <a href="mailto:hi@menzit.com">hi@menzit.com</a>\n                    </div>\n                </div>\n            </form>\n        </div>\n    </div>\n</div>')
}]),angular.module("home.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("home.html",'<div class="home-view">\n    <div class="content">\n        <div class="main">\n            <div class="title">\n                <h1>Learning has never been so easy...</h1>\n            </div>\n            <div class="media">\n                <img src="/src/portal/home/main.svg" />\n            </div>\n            <div class="action">\n                <button ui-sref="app.categories">Play!</button>\n            </div>\n        </div>\n        <div class="secondary">\n            <div class="secondary-content cf">\n                <div class="l-1-2 secondary-column secondary-learn">\n                    <h1>Learn</h1>\n                    <img class="secondary-column-image" src="/src/portal/home/learn.svg" />\n                    Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus ut orci a nunc convallis pretium at nec eros.\n                </div>\n                <div class="l-1-2 secondary-column secondary-play">\n                    <h1>Play!</h1>\n                    <img class="secondary-column-image" src="/src/portal/home/play.svg" />\n                    Ut ac arcu dui. Ut cursus tempus eros in aliquet. Morbi vitae adipiscing mauris. Sed gravida accumsan suscipit.\n                </div>\n            </div>\n        </div>\n    </div>\n</div>')}]),angular.module("howItWorks.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("howItWorks.html",'<div class="how-it-works-view">\n    <div class="l-row how-it-works-concept">\n        <div class="l-1-2">\n            <h2>1. Select a category</h2>\n            Choose a topic of your motivation.<br/><br/>\n            We have lots of different subjects to allow you to concentrate on your interests.\n        </div>\n        <div class="l-1-2">\n            <img class="how-it-works-image" src="/src/portal/howItWorks/category.svg" />\n        </div>\n    </div>\n    <div class="l-row how-it-works-concept">\n        <div class="l-1-2 how-it-works-concept-text">\n            <h2>2. Learn while playing</h2>\n            Improve your skills in a funny way<br/><br/>\n            Answer questions related to the topic you selected.\n        </div>\n        <div class="l-1-2 how-it-works-concept-image">\n            <img class="how-it-works-image" src="/src/portal/howItWorks/play.svg" />\n        </div>\n    </div>\n    <div class="l-row how-it-works-concept">\n        <div class="l-1-2">\n            <h2>3. Compare with friends and improve</h2>\n            Check your score\n        </div>\n        <div class="l-1-2">\n            <img class="how-it-works-image" src="/src/portal/howItWorks/improve.svg" />\n        </div>\n    </div>\n</div>')}]),angular.module("portal.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("portal.html",'<div class="portal" ng-class="getPageStyleClass()">\n    <div class="header">\n        <div class="header-logo">\n            <a ui-sref="portal.home">\n                <img src="/src/portal/logo.svg" />\n            </a>\n        </div>\n        <div class="header-menu" ng-class="{ \'header-menu-mobile-visible\': visibleMobileMenu }">\n            <a class="header-menu-link" ui-sref="portal.home" ng-class="getActiveClass(\'portal.home\')">Home</a>\n            <a class="header-menu-link" ui-sref="app.categories">Play!</a>\n            <a class="header-menu-link" ui-sref="portal.howItWorks" ng-class="getActiveClass(\'portal.howItWorks\')">How it works</a>\n            <a class="header-menu-link" ui-sref="portal.contact" ng-class="getActiveClass(\'portal.contact\')">Contact</a>\n            <a class="header-menu-link" href="#" ng-click="showLoginDialog()" ng-if="!session">Log in</a>\n            <div class="header-menu-logged-user" ng-if="session">\n                <div class="header-menu-text header-menu-link-current-user">Hi, {{getUserName(session)}}</div>\n                <a class="header-menu-link" href="#" ng-click="logout()">[Logout]</a>\n            </div>\n        </div>\n        <div class="header-menu-mobile-toggle">\n            <button class="dark-theme" ng-click="visibleMobileMenu = ( visibleMobileMenu !== true )">\n                <icon class="menu-icon"></icon>\n            </button>\n        </div>\n    </div>\n    <login visible="isLoginVisible"></login>\n    <div ui-view></div>\n    <div class="footer">Copyright © 2015 menzit. All rights reserved.</div>\n</div>')}]),menzit.controller("PortalCtrl",["$rootScope","$scope","$state","session","pubSub",function($rootScope,$scope,$state,session,pubSub){function setUserSession(){session.getSession().then(function(session){$scope.session=session})}$scope.session={},setUserSession(),$scope.getActiveClass=function(targetState){return{active:$state.current.name===targetState}},$scope.getPageStyleClass=function(){var pageStyleClass={};return pageStyleClass["state-"+$state.current.name.replace(/\./,"-")]=!0,pageStyleClass},$scope.showLoginDialog=function(){$scope.isLoginVisible=!0},$scope.getUserName=function(userSession){var userName;return userName=userSession.firstName?userSession.firstName:userSession.lastName?userSession.lastName:userSession.userName},$scope.logout=function(){session.logout().then(function(){$scope.session=null})},$rootScope.$on("$stateChangeSuccess",function(){$scope.visibleMobileMenu=!1}),pubSub.subscribe("login",function(){setUserSession()})}]),portal.controller("ContactCtrl",["$scope","http",function($scope,http){$scope.submitContact=function(){http.post("/rest/contact",$scope.contactData).then(function(){$scope.success=!0}).catch(function(){$scope.error=!0})}}]),portal.controller("HomeCtrl",[function(){}]),portal.controller("HowItWorksCtrl",[function(){}]),menzit.controller("AppCtrl",["$rootScope","$scope","$state",function($rootScope,$scope,$state){function setCurrentStateStyleClasses(currentState){stateName=currentState.name.replace(/\./g,"-"),stateGroupId=currentState.data?"state-"+currentState.data.groupId.replace(/\./g,"-"):""}var stateName,stateGroupId;setCurrentStateStyleClasses($state.current),$rootScope.$on("$stateChangeSuccess",function(e,toState){setCurrentStateStyleClasses(toState)}),$scope.getPageStyleClasses=function(){var rootStyleClasses={};return rootStyleClasses.root=!0,rootStyleClasses[stateName]=!0,rootStyleClasses[stateGroupId]=!0,rootStyleClasses}}]),app.controller("AdminCtrl",["$scope","$state",function(){}]),app.controller("CategoriesAdminCtrl",["$scope","$state","http",function($scope,$state,http){function loadCategories(){http.get("/rest/categories").then(function(response){$scope.categories=response})}loadCategories(),$scope.add=function(){$state.go("app.admin.addCategory")},$scope.edit=function(category){$state.go("app.admin.editCategory",{categoryId:category._id})},$scope.viewTests=function(category){$state.go("app.admin.tests",{categoryId:category._id})},$scope.confirmDelete=function(category){$scope.categoryToBeDeleted=category},$scope.delete=function(){http.delete("/rest/categories/"+$scope.categoryToBeDeleted._id).then(function(){var mediaId=$scope.categoryToBeDeleted.media&&$scope.categoryToBeDeleted.media._id;$scope.categoryToBeDeleted=null,loadCategories(),mediaId&&http.delete("/rest/media/"+mediaId)})}}]),app.controller("CategoryAddAdminCtrl",["$scope","$state","http",function($scope,$state,http){$scope.title="Add category",$scope.category={tests:[]},$scope.submit=function(){$scope.uploadRequestFn().then(function(){http.post("/rest/categories/",$scope.category).then(function(){$state.go("app.admin.categories")})})}}]),app.controller("CategoryEditAdminCtrl",["$scope","$state","http","category",function($scope,$state,http,category){$scope.title="Edit category",$scope.category=category,$scope.submit=function(){$scope.uploadRequestFn().then(function(){var categoryRestUrl="/rest/categories/"+$state.params.categoryId;http.put(categoryRestUrl,$scope.category).then(function(){$state.go("app.admin.categories")})})}}]),app.config(function($stateProvider){$stateProvider.state("app.admin.categories",{url:"/categories",templateUrl:"categoriesAdmin.html",controller:"CategoriesAdminCtrl",pageTitle:"Admin categories",data:{groupId:"adminTests"}}).state("app.admin.addCategory",{url:"/categories/add",templateUrl:"categoryAdmin.html",controller:"CategoryAddAdminCtrl",pageTitle:"Add a category",data:{groupId:"adminTests"}}).state("app.admin.editCategory",{url:"/categories/edit/:categoryId",templateUrl:"categoryAdmin.html",controller:"CategoryEditAdminCtrl",pageTitle:"Edit category",resolve:{category:["$stateParams","http",function($stateParams,http){return http.get("/rest/categories/"+$stateParams.categoryId)}]},data:{groupId:"adminTests"}})}),app.controller("TestAddAdminCtrl",["$scope","$state","http","testAdmin",function($scope,$state,http,testAdmin){function setupData(){$scope.test.answers=testAdmin.getNormalizedOutputAnswers($scope.test.answers),angular.forEach($scope.test.answers,function(answer,$index){answer.isCorrect=$index===Number($scope.correctOptionIndex)})}function submitMetaData(){http.post("/rest/tests/",$scope.test).then(function(){$state.go("app.admin.tests",{categoryId:$state.params.categoryId})})}$scope.title="Add test",$scope.correctOptionIndex=0,$scope.uploadAnswerRequestFns=new Array(4),$scope.test={categoryId:$state.params.categoryId,answers:[{},{},{},{}]},$scope.submit=function(){$scope.uploadQuestionRequestFn().then(function(){angular.forEach($scope.uploadAnswerRequestFns,function(uploadAnswerRequestFn,$index){uploadAnswerRequestFn().then(function(){$index===$scope.uploadAnswerRequestFns.length-1&&(setupData(),submitMetaData())})})})}}]),app.controller("TestEditAdminCtrl",["$scope","$state","http","test","testAdmin",function($scope,$state,http,test,testAdmin){function setupData(){$scope.test.answers=testAdmin.getNormalizedOutputAnswers($scope.test.answers),angular.forEach($scope.test.answers,function(answer,$index){answer.isCorrect=$index===Number($scope.correctOptionIndex)})}function submitMetaData(){http.put("/rest/tests/"+$state.params.testId,$scope.test).then(function(){$state.go("app.admin.tests",{categoryId:$state.params.categoryId})})}$scope.title="Edit test",$scope.test=test,$scope.test.answers=testAdmin.getNormalizedInputAnswers($scope.test.answers),$scope.uploadAnswerRequestFns=new Array(4),angular.forEach($scope.test.answers,function(answer,$index){answer.isCorrect&&($scope.correctOptionIndex=$index)}),$scope.submit=function(){$scope.uploadQuestionRequestFn().then(function(){angular.forEach($scope.uploadAnswerRequestFns,function(uploadAnswerRequestFn,$index){uploadAnswerRequestFn().then(function(){$index===$scope.uploadAnswerRequestFns.length-1&&(setupData(),submitMetaData())})})})}}]),app.controller("TestsAdminCtrl",["$scope","$state","http","category",function($scope,$state,http,category){function loadTests(){var endpoint="/rest/tests?categoryId="+$state.params.categoryId;http.get(endpoint).then(function(tests){$scope.tests=tests})}function deleteMedia(){var mediaId=$scope.testToBeDeleted.question.media&&$scope.testToBeDeleted.question.media._id;submitDeleteMedia(mediaId),angular.forEach($scope.testToBeDeleted.answers,function(answer){mediaId=answer.media&&answer.media._id,submitDeleteMedia(mediaId)})}function submitDeleteMedia(mediaId){mediaId&&http.delete("/rest/media/"+mediaId)}loadTests(),$scope.category=category,$scope.add=function(){$state.go("app.admin.addTest",{categoryId:$state.params.categoryId})},$scope.edit=function(test){$state.go("app.admin.editTest",{testId:test._id,categoryId:$state.params.categoryId})},$scope.confirmDelete=function(test){$scope.testToBeDeleted=test},$scope.delete=function(){http.delete("/rest/tests/"+$scope.testToBeDeleted._id).then(function(){loadTests(),deleteMedia(),$scope.testToBeDeleted=null})}}]),app.factory("testAdmin",[function(){function getNormalizedInputAnswers(answers){for(var maxAnswers=4,i=answers.length;maxAnswers>i;i++)answers.push({});return answers}function getNormalizedOutputAnswers(answers){var normalizedAnswers=[];return angular.forEach(answers,function(answer){(answer.title||answer.media&&answer.media._id)&&normalizedAnswers.push(answer)}),normalizedAnswers}return{getNormalizedInputAnswers:getNormalizedInputAnswers,getNormalizedOutputAnswers:getNormalizedOutputAnswers}}]),app.config(function($stateProvider){$stateProvider.state("app.admin.tests",{url:"/categories/:categoryId/tests",templateUrl:"testsAdmin.html",controller:"TestsAdminCtrl",resolve:{category:["$stateParams","http",function($stateParams,http){return http.get("/rest/categories/"+$stateParams.categoryId)}]},data:{groupId:"adminTests"}}).state("app.admin.addTest",{url:"/categories/:categoryId/tests/add",templateUrl:"testAdmin.html",controller:"TestAddAdminCtrl",data:{groupId:"adminTests"}}).state("app.admin.editTest",{url:"/categories/:categoryId/tests/edit/:testId",templateUrl:"testAdmin.html",controller:"TestEditAdminCtrl",resolve:{test:["$stateParams","http",function($stateParams,http){return http.get("/rest/tests/"+$stateParams.testId)}]},data:{groupId:"adminTests"}})}),app.controller("TenantAddCtrl",["$scope","$state","http",function($scope,$state,http){$scope.title="Add tenant",$scope.submit=function(){$scope.uploadRequestFn().then(function(){http.post("/rest/tenants/",$scope.tenant).then(function(){$state.go("app.admin.tenants")})})}}]),app.controller("TenantEditCtrl",["$scope","$state","$q","http","tenant",function($scope,$state,$q,http,tenant){$scope.title="Edit tenant",$scope.tenant=tenant,$scope.submit=function(){var tenantRestUrl="/rest/tenants/"+$state.params.tenantId;$scope.uploadRequestFn().then(function(){http.put(tenantRestUrl,$scope.tenant).then(function(){$state.go("app.admin.tenants")})})}}]),app.controller("TenantsCtrl",["$rootScope","$scope","$state","http",function($rootScope,$scope,$state,http){function loadTenants(){http.get("/rest/tenants").then(function(response){$scope.tenants=response})}loadTenants(),$scope.add=function(){$state.go("app.admin.addTenant")},$scope.edit=function(tenant){$state.go("app.admin.editTenant",{tenantId:tenant._id})},$scope.confirmDelete=function(tenant){$scope.tenantToBeDeleted=tenant},$scope.delete=function(){http.delete("/rest/tenants/"+$scope.tenantToBeDeleted._id).then(function(){var mediaId=$scope.tenantToBeDeleted.media&&$scope.tenantToBeDeleted.media._id;$scope.tenantToBeDeleted=null,loadTenants(),mediaId&&http.delete("/rest/media/"+mediaId)})}}]),app.config(function($stateProvider){$stateProvider.state("app.admin.tenants",{url:"/tenants",templateUrl:"tenants.html",controller:"TenantsCtrl",pageTitle:"Admin tenants",data:{groupId:"adminTenants"}}).state("app.admin.addTenant",{url:"/tenants/add",templateUrl:"tenant.html",controller:"TenantAddCtrl",pageTitle:"Add a tenant",data:{groupId:"adminTenants"}}).state("app.admin.editTenant",{url:"/tenants/edit/:tenantId",templateUrl:"tenant.html",controller:"TenantEditCtrl",pageTitle:"Edit tenant",resolve:{tenant:["$stateParams","http",function($stateParams,http){return http.get("/rest/tenants/"+$stateParams.tenantId)}]},data:{groupId:"adminTenants"}})}),app.controller("UserAddAdminCtrl",["$scope","$state","http","constants",function($scope,$state,http,constants){$scope.title="Add user",$scope.roles=constants.roles,$scope.user={role:$scope.roles[0]._id},$scope.submit=function(){$scope.uploadRequestFn().then(function(){http.post("/rest/users/",$scope.user).then(function(){$state.go("app.admin.users")})})}}]),app.controller("UserEditAdminCtrl",["$scope","$state","http","user","constants",function($scope,$state,http,user,constants){$scope.title="Edit user",$scope.user=user,$scope.roles=constants.roles,$scope.showForceChangePasswordLink=!0,$scope.submit=function(){$scope.uploadRequestFn().then(function(){http.put("/rest/users/"+$state.params.userId,$scope.user).then(function(){$state.go("app.admin.users")})})},$scope.forceChangePassword=function(){$scope.showForceChangePasswordLink=!1}}]),app.controller("UsersAdminCtrl",["$scope","$state","http",function($scope,$state,http){function loadUsers(){http.get("/rest/users").then(function(response){$scope.users=response})}loadUsers(),$scope.add=function(){$state.go("app.admin.addUser")},$scope.edit=function(user){$state.go("app.admin.editUser",{userId:user._id})},$scope.confirmDelete=function(user){$scope.userToBeDeleted=user},$scope.delete=function(){http.delete("/rest/users/"+$scope.userToBeDeleted._id).then(function(){var mediaId=$scope.userToBeDeleted.media&&$scope.userToBeDeleted.media._id;$scope.userToBeDeleted=null,loadUsers(),mediaId&&http.delete("/rest/media/"+mediaId)})}}]),app.config(function($stateProvider){$stateProvider.state("app.admin.users",{url:"/users",templateUrl:"usersAdmin.html",controller:"UsersAdminCtrl",pageTitle:"Admin users",data:{groupId:"adminUsers"}}).state("app.admin.addUser",{url:"/users/add",templateUrl:"userAdmin.html",controller:"UserAddAdminCtrl",pageTitle:"Add a user",data:{groupId:"adminUsers"}}).state("app.admin.editUser",{url:"/users/edit/:userId/{current}",templateUrl:"userAdmin.html",controller:"UserEditAdminCtrl",pageTitle:"Edit user",data:{groupId:"adminUsers"},resolve:{user:["$stateParams","http",function($stateParams,http){return http.get("/rest/users/"+$stateParams.userId)}]}})}),app.controller("CategoriesCtrl",["$scope","$state","http",function($scope,$state,http){http.get("/rest/categories").then(function(response){$scope.categories=response}),$scope.launchTest=function(category){$state.go("app.test",{categoryId:category._id})},$scope.getBackgroundImageStyle=function(category){var backgroundImage=category.media&&category.media._id;return backgroundImage?{"background-image":"url(/media/"+backgroundImage+")"}:{}}}]),app.directive("audio",["$sce",function($sce){return{restrict:"A",templateUrl:"audio.html",replace:!0,scope:{audio:"="},link:function(scope,element){scope.play=function(){var audioElement=element.find("audio")[0];audioElement.pause(),audioElement.load(),audioElement.play()},scope.getAudioSrc=function(audio){var encodedAudio,endpoint;return audio?(encodedAudio=encodeURIComponent(audio.toLowerCase()),endpoint="http://tts-api.com/tts.mp3",$sce.trustAsResourceUrl(endpoint+"?q="+encodedAudio)):""}}}}]),app.directive("autoComplete",["http",function(http){return{restrict:"A",templateUrl:"autoComplete.html",scope:{ngModel:"=",endpoint:"@",displayProperty:"@",singleSelection:"="},link:function(scope){function fillTagsInfo(ngModel,endpoint,displayProperty){scope.singleSelection?fillTagInfo(endpoint,ngModel,displayProperty,0):ngModel.forEach(function(tagId,$index){fillTagInfo(endpoint,tagId,displayProperty,$index)})}function updateSingleSelectionNgModel(tags){scope.ngModel=areThereTags(tags)?tags[0]._id:""}function updateMultiSelectionNgModel(tags){scope.ngModel.length=0,areThereTags(tags)&&tags.forEach(function(tag){scope.ngModel.push(tag._id)})}function areThereTags(tags){return tags&&tags.length}function fillTagInfo(endpoint,tagId,displayProperty,$index){http.get(endpoint+"/"+tagId).then(function(tag){scope.tags.push({_id:tagId}),scope.tags[$index][displayProperty]=tag[displayProperty]})}scope.tags=[],scope.maxTags=scope.singleSelection?1:null,scope.placeholder=" ",scope.ngModel?fillTagsInfo(scope.ngModel,scope.endpoint,scope.displayProperty):scope.ngModel=scope.singleSelection?"":[],scope.source=function($query){return http.get(scope.endpoint+"?search="+$query)},scope.onTagAdded=function($tag){scope.singleSelection&&(scope.tags.length=0,scope.tags.push($tag))},scope.$watch("tags",function(tags){scope.singleSelection?updateSingleSelectionNgModel(tags):updateMultiSelectionNgModel(tags)},!0)}}}]),function(){app.directive("dialog",[function(){return{replace:!1,restrict:"A",transclude:!0,scope:{title:"@",mzIf:"="},templateUrl:"dialog.html",link:function(scope){scope.hideDialog=function(){scope.mzIf=!1},angular.element(document).bind("keyup",function(e){27===e.keyCode&&(scope.hideDialog(),scope.$apply())})}}}]),app.directive("centered",[function(){return{restrict:"A",link:function(scope,element){var elementHeight=element.outerHeight(),elementWidth=element.outerWidth();scope.centerBox=function(){return{marginTop:-(elementHeight/2),marginLeft:-(elementWidth/2)}}}}}])}(),app.controller("BaseQuestionCtrl",["$scope","http",function($scope,http){$scope.answerCodes=["A","B","C","D"],$scope.getBackgroundMediaStyle=function(answer){var backgroundImage=answer&&answer.media&&answer.media._id;return backgroundImage?{"background-image":"url(/media/"+backgroundImage+")"}:{}},$scope.getQuestionStyleClasses=function(question){return{"has-background-image":question&&question.media&&question.media._id}},$scope.getAnswerStyleClasses=function(answer){return{"valid-assert":answer.validAssert,"invalid-assert":answer.invalidAssert,"has-text":answer.title,"has-background-image":answer.media&&answer.media._id}},$scope.setAnswer=function(question,answerIndex){var isCorrectEndpoint="/rest/tests/"+question._id+"/isCorrect/"+answerIndex,answer=question.answers[answerIndex];http.get(isCorrectEndpoint).then(function(response){response.isCorrect?$scope.setCorrectAnswer(answer,question._id):$scope.setIncorrectAnswer(answer,question._id)})}}]),app.directive("title",[function(){return{link:function(scope,element,attrs){element.data("powertip",attrs.title),element.powerTip({})}}}]),app.directive("truncate",["$timeout",function($timeout){return{link:function(scope,element){$timeout(function(){element.dotdotdot({watch:"window"})})}}}]),app.directive("fileModel",["$parse",function($parse){return{restrict:"A",link:function(scope,element,attrs){var model=$parse(attrs.fileModel),modelSetter=model.assign;element.bind("change",function(){scope.$apply(function(){modelSetter(scope,element[0].files[0])})})}}}]),app.directive("upload",["$q","$timeout","http",function($q,$timeout,http){return{replace:!0,templateUrl:"upload.html",scope:{media:"=ngModel",onSubmitRequest:"="},link:function(scope,element){function handleFileSelect(evt){var reader,file=evt.target.files[0];file.type.match("image.*")&&(reader=new FileReader,reader.onload=function(){return function(e){scope.toBeUpdated=!0,scope.toBeDeleted=!1,scope.base64=e.target.result,scope.$apply()}}(),reader.readAsDataURL(file))}function getSubmitHeaders(){return{transformRequest:angular.identity,headers:{"Content-Type":void 0}}}function submit(uploadUrl,fileDescriptor){var deferred=$q.defer();return cUDSubit(uploadUrl,fileDescriptor).then(function(media){onSubmitSuccess(media,deferred)}).catch(function(){onSubmitError(deferred)}),deferred.promise}function cUDSubit(uploadUrl,fileDescriptor){return scope.media._id||!fileDescriptor||scope.toBeDeleted?scope.media._id?cUDSubitExistingMedia(uploadUrl,fileDescriptor):$q.when([scope.media]):http.post(uploadUrl,fileDescriptor,getSubmitHeaders())}function cUDSubitExistingMedia(uploadUrl,fileDescriptor){return scope.toBeDeleted?http.delete(uploadUrl):scope.toBeUpdated?http.put(uploadUrl,fileDescriptor,getSubmitHeaders()):$q.when([scope.media])}function onSubmitSuccess(media,deferred){refreshToken(),scope.media._id=media&&media[0]?media[0]._id:void 0,$timeout(function(){deferred.resolve(media)},1e3)}function onSubmitError(deferred){deferred.reject()}function refreshToken(){scope.refreshToken=Math.floor(1e4*Math.random())}var inputElement=angular.element('input[type="file"]',element);refreshToken(),scope.media||(scope.media={}),inputElement.bind("change",handleFileSelect),scope.onSubmitRequest=function(){var file=scope.selectedFile,uploadUrl="/rest/media/"+(scope.media._id||""),fileDescriptor=new FormData;return fileDescriptor.append("file",file),submit(uploadUrl,file?fileDescriptor:null)},scope.remove=function(){scope.toBeDeleted=!0,scope.toBeUpdated=!1,inputElement.val("")}}}}]),function(){app.directive("menu",["$state","session","pubSub","constants",function($state,session,pubSub,constants){return{replace:!0,restrict:"A",templateUrl:"menu.html",link:function(scope){function setUserSession(){session.getSession().then(function(session){scope.session=session})}session.getSession().then(function(session){scope.session=session}),scope.hasAdminRole=function(){return session.hasAdminRole()},scope.showAdminOptions=function(){$state.go("app.admin.tenants")},scope.showLoginDialog=function(){scope.isLoginVisible=!0},scope.isActiveAction=function(){var stateData=$state.current.data;return{active:stateData&&"admin"===stateData.groupId}},scope.toggleActiveMenuPanel=function(){scope.isPanelActive=scope.isPanelActive!==!0},scope.getTenantLogo=function(){return scope.session&&session.tenant&&session.tenant.media&&session.tenant.media._id||constants.logoPath},pubSub.subscribe("login",function(){setUserSession()}),pubSub.subscribe("logout",function(){scope.session=null,scope.$apply()})}}}])}(),app.directive("menuPanel",["$rootScope","$state","session","pubSub",function($rootScope,$state,session,pubSub){return{restrict:"E",templateUrl:"menuPanel.html",replace:!0,scope:{isActive:"="},link:function(scope){function setUserSession(){session.getSession().then(function(session){scope.session=session})}scope.session={},setUserSession(),scope.isActiveItem=function(item){return{active:item===($state.params.current||$state.current.data&&$state.current.data.groupId)}},scope.logout=function(){session.logout().then(function(){scope.isActive=!1,$state.go("app.categories")})},scope.hideMenuPanel=function(){scope.isActive=!1},scope.getUserName=function(userSession){var userName;return userName=userSession.firstName?userSession.firstName+(userSession.lastName?" "+userSession.lastName:""):userSession.lastName?userSession.lastName:userSession.userName},$rootScope.$on("$stateChangeSuccess",function(){scope.isActive=!1}),pubSub.subscribe("login",function(){setUserSession()})}}}]),function(){app.controller("TestDataCtrl",["$scope","$interval","pubSub",function($scope,$interval,pubSub){var scoreUpdatedSub,updateScoreIntervalFn;$scope.score=0,$scope.setProgressWidth=function(){return $scope.testData?{width:$scope.testData.runnedQuestions/$scope.testData.totalQuestions*100+"%"}:null},scoreUpdatedSub=pubSub.subscribe("scoreUpdated",function(msg,data){$scope.testData=data,$scope.$apply(),updateScoreIntervalFn=$interval(function(){$scope.score<$scope.testData.score?$scope.score+=1:$interval.cancel(updateScoreIntervalFn)},5)}),$scope.getCurrentQuestion=function(){return $scope.testData.runnedQuestions<$scope.testData.totalQuestions?$scope.testData.runnedQuestions+1:$scope.testData.runnedQuestions},$scope.$on("$destroy",function(){$interval.cancel(updateScoreIntervalFn),pubSub.unsubscribe(scoreUpdatedSub)})}])}(),app.controller("ReviewCtrl",["$scope","$state","questions",function($scope,$state,questions){$scope.questions=questions,$scope.getBackgroundImageStyle=function(answer){return{backgroundImage:"url("+(answer.media&&answer.media._id)+")"}},$scope.reviewQuestion=function(questionId){$state.go("app.reviewQuestion",{questionId:questionId})}}]),app.controller("ReviewQuestionCtrl",["$scope","$controller","$timeout","$state","$q","http","question",function($scope,$controller,$timeout,$state,$q,http,question){function setCurrentQuestion(question){$scope.question=question,$scope.isCorrectAnswer=!1}function manageNextQuestion(){getNextQuestion().then(function(nextQuestion){$timeout(function(){nextQuestion?setCurrentQuestion(nextQuestion):$state.go("app.review")},1e3)})}function getNextQuestion(){var deferred=$q.defer();return http.get("/rest/incorrectAnswers/first").then(function(incorrectAnswer){deferred.resolve(incorrectAnswer.question)}),deferred.promise}$controller("BaseQuestionCtrl",{$scope:$scope}),setCurrentQuestion(question),$scope.setCorrectAnswer=function(answer,questionId){$scope.isCorrectAnswer=!0,answer.validAssert=!0,http.post("/rest/incorrectAnswers/"+questionId+"/addCorrect").then(manageNextQuestion)},$scope.setIncorrectAnswer=function(answer,questionId){answer.invalidAssert=answer.invalidAssert?!1:!answer.isCorrect,http.post("/rest/incorrectAnswers/"+questionId)}}]),app.controller("TestCtrl",["$scope","$timeout","pubSub",function($scope,$timeout,pubSub){function finishTest(){$timeout(function(){$scope.isTestInProgress=!1,$timeout(function(){$scope.isTestFinished=!0},1e3)},1500)}$scope.isTestInProgress=!0;var scoreUpdatedSub=pubSub.subscribe("testFinished",function(){finishTest()});$scope.$on("$destroy",function(){pubSub.unsubscribe(scoreUpdatedSub)})}]),app.controller("QuestionsCtrl",["$scope","$controller","$timeout","$state","http","pubSub",function($scope,$controller,$timeout,$state,http,pubSub){function setCurrentQuestion(){var questionId=getQuestionId();runnedQuestions.push(questionId),failedAnswers=0,$scope.question=availableQuestions[questionId]}function getQuestionId(){var proposedQuestionIndex;do proposedQuestionIndex=parseInt(Math.random()*availableQuestions.length);while(runnedQuestions.indexOf(proposedQuestionIndex)>=0);return proposedQuestionIndex}function isLastQuestion(){return runnedQuestions.length===availableQuestions.length}function setScore(){var maxQuestionScore=100;void 0===$scope.score?$scope.score=0:$scope.score+=maxQuestionScore-failedAnswers*Math.ceil(maxQuestionScore/$scope.question.answers.length),sendScoreEvent()}function sendScoreEvent(){pubSub.publish("scoreUpdated",{score:$scope.score,runnedQuestions:runnedQuestions.length,totalQuestions:availableQuestions.length})}var failedAnswers,availableQuestions=[],runnedQuestions=[];$controller("BaseQuestionCtrl",{$scope:$scope}),http.get("/rest/tests?categoryId="+$state.params.categoryId).then(function(questions){availableQuestions=questions,setScore(),setCurrentQuestion()}),$scope.getNextQuestion=function(){setCurrentQuestion(),$scope.isCorrectAnswer=!1},$scope.setCorrectAnswer=function(answer){$scope.isCorrectAnswer=!0,answer.validAssert=!0,setScore(),isLastQuestion()?pubSub.publish("testFinished",{score:$scope.score}):$timeout(function(){$scope.getNextQuestion()},1e3)},$scope.setIncorrectAnswer=function(answer,questionId){answer.invalidAssert=answer.invalidAssert?!1:!answer.isCorrect,failedAnswers<$scope.question.answers.length-1&&failedAnswers++,http.post("/rest/incorrectAnswers/"+questionId)}}]),app.controller("ResultsCtrl",["$scope","$state","$timeout","$interval","$q","$stateParams","http","pubSub",function($scope,$state,$timeout,$interval,$q,$stateParams,http,pubSub){function finishTest(score){displayResult(score),saveScore(score).then(loadBestResults)}function loadBestResults(){http.get("/rest/scores?categoryId="+$state.params.categoryId).then(function(bestResults){$scope.bestResults=bestResults})}function displayResult(score){$timeout(function(){$scope.score=0,updateScoreIntervalFn=$interval(function(){$scope.score<score?$scope.score+=1:($interval.cancel(updateScoreIntervalFn),$timeout(function(){$scope.showBestResults=!0},3e3))},5)},3500)}function saveScore(score){var deferred=$q.defer();return http.post("/rest/scores/",{score:score,categoryId:$state.params.categoryId}).then(function(savedScore){currentResult=savedScore,deferred.resolve(savedScore)}),deferred.promise}var scoreUpdatedSub,updateScoreIntervalFn,currentResult;scoreUpdatedSub=pubSub.subscribe("testFinished",function(msg,data){finishTest(data.score)}),$scope.$on("$destroy",function(){pubSub.unsubscribe(scoreUpdatedSub)}),$scope.isCurrentBestResult=function(bestResult){return bestResult._id===currentResult._id},$scope.repeatTest=function(){$state.transitionTo($state.current,$stateParams,{reload:!0,inherit:!1,notify:!0})},$scope.goToHome=function(){$state.go("app.categories")}}]);