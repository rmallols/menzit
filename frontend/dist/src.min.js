/* Minified js files! 2014-12-12 */
"use strict";var menzit=angular.module("menzit",["portal","app","ui.router","templates-main"]);less={env:"development",logLevel:0};var app=angular.module("app",["ngAnimate","ngTagsInput"]);app.config(function($locationProvider,$stateProvider,$urlRouterProvider){$locationProvider.html5Mode(!0),$stateProvider.state("app",{templateUrl:"app.html",controller:"AppCtrl",resolve:{userSession:["http","session",function(http,session){return session.getSession()}]}}).state("app.categories",{url:"/categories",templateUrl:"categories.html",controller:"CategoriesCtrl"}).state("app.test",{url:"/categories/:categoryId/test",templateUrl:"test.html",controller:"TestCtrl"}).state("app.admin",{url:"/admin",templateUrl:"admin.html",controller:"AdminCtrl",data:{groupId:"admin"}}),$urlRouterProvider.otherwise("/")});var portal=angular.module("portal",["ui.router"]);portal.config(function($locationProvider,$stateProvider,$urlRouterProvider){$locationProvider.html5Mode(!0),$stateProvider.state("portal",{templateUrl:"portal.html",controller:"PortalCtrl"}).state("portal.home",{url:"/home",templateUrl:"home.html",controller:"HomeCtrl"}),$urlRouterProvider.otherwise("/")}),menzit.value("constants",{roles:[{_id:0,name:"Plain user"},{_id:1,name:"Admin user"},{_id:2,name:"Super admin user"}]}),menzit.config(["$httpProvider",function($httpProvider){$httpProvider.interceptors.push(["loading",function(loading){return{request:function(config){return loading.start(),config},response:function(response){return loading.done(),response}}}])}]),menzit.service("http",["$http","$q",function($http,$q){function get(url){var deferred=$q.defer();return $http.get(url).then(function(response){deferred.resolve(response.data)}),deferred.promise}function post(url,data){var deferred=$q.defer();return $http.post(url,data).then(function(response){deferred.resolve(response.data)}),deferred.promise}function put(url,data){var deferred=$q.defer();return $http.put(url,data).then(function(response){deferred.resolve(response.data)}),deferred.promise}function remove(url){var deferred=$q.defer();return $http.delete(url).then(function(response){deferred.resolve(response.data)}),deferred.promise}return{get:get,post:post,put:put,"delete":remove}}]),menzit.service("loading",["$timeout",function($timeout){function start(){NProgress.inc()}function done(){$timeout(function(){NProgress.done()},1e3)}return{start:start,done:done}}]),menzit.service("pubSub",[function(){function publish(eventName,data){PubSub.publish(eventName,data)}function subscribe(eventName,subscribeFn){return PubSub.subscribe(eventName,subscribeFn)}function unsubscribe(subscribeFn){PubSub.unsubscribe(subscribeFn)}return{publish:publish,subscribe:subscribe,unsubscribe:unsubscribe}}]),menzit.service("session",["$q","http",function($q,http){function login(userName,password){var deferred=$q.defer(),credentials={userName:userName,password:password};return http.post("/rest/login",credentials).then(function(retrievedSession){session=retrievedSession,deferred.resolve(retrievedSession)}),deferred.promise}function logout(){var deferred=$q.defer();return http.post("/rest/logout").then(function(){session=void 0,deferred.resolve()}),deferred.promise}function getSession(){var deferred=$q.defer();return session?deferred.resolve(session):http.get("/rest/session/").then(function(retrievedSession){session=retrievedSession,deferred.resolve(session)}),deferred.promise}function isLoggedUser(){return session}function isSuperAdminUser(){return session&&2===session.role}function isAdminUser(){return session&&1===session.role}function isPlainUser(){return isLoggedUser()&&!isSuperAdminUser()&&isPlainUser()}function hasAdminRole(){return isAdminUser()||isSuperAdminUser()}var session;return{login:login,logout:logout,getSession:getSession,isLoggedUser:isLoggedUser,isSuperAdminUser:isSuperAdminUser,isAdminUser:isAdminUser,isPlainUser:isPlainUser,hasAdminRole:hasAdminRole}}]),angular.module("templates-main",["admin.html","categoriesAdmin.html","categoryAdmin.html","testAdmin.html","testsAdmin.html","tenant.html","tenants.html","userAdmin.html","usersAdmin.html","app.html","categories.html","autoComplete.html","dialog.html","upload.html","menu.html","testData.html","questions.html","results.html","test.html","index.html","home.html","portal.html"]),angular.module("admin.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("admin.html",'<div class="admin-view">\n    <div class="menu">\n        <a ng-repeat="action in menuActions" ui-sref="{{action.uiSref}}"\n             class="action" ng-class="isActiveAction(action.subGroupId)">\n            <icon class="{{action.icon}}"></icon>\n            <div>{{action.label}}</div>\n        </a>\n    </div>\n    <div ui-view></div>\n</div>')}]),angular.module("categoriesAdmin.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("categoriesAdmin.html",'<div class="categories-admin-view">\n    <div class="cf">\n        <h1 class="float-left">Manage categories</h1>\n        <div class="float-right">\n            <button class="important" ng-click="add()">Add</button>\n        </div>\n    </div>\n    <div class="category" ng-repeat="category in categories">\n        <div class="float-left">\n            {{category.title}}\n        </div>\n        <div class="float-right">\n            <button>\n                <icon class="up-icon"></icon>\n            </button>\n            <button>\n                <icon class="down-icon"></icon>\n            </button>\n            <button ng-click="edit(category)">Edit</button>\n            <button class="important" ng-click="viewTests(category)">View tests</button>\n            <button class="delete" ng-click="confirmDelete(category)">Delete</button>\n        </div>\n    </div>\n    <div dialog mz-if="categoryToBeDeleted" title="Delete category">\n        <label class="warning">Warning</label><br/>\n        The following category and all the tests attached to it will be deleted<br/><br/>\n        <b>{{categoryToBeDeleted.title}}</b><br/><br/>\n        <button class="delete" ng-click="delete()">Delete</button>\n    </div>\n</div>\n')}]),angular.module("categoryAdmin.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("categoryAdmin.html",'<div class="category-view">\n    <div class="cf">\n        <h1 class="float-left">{{title}}</h1>\n\n        <div class="float-right">\n            <button class="important" ng-click="submit()">Save</button>\n        </div>\n    </div>\n    <div class="cf">\n        <div class="l-1-3 input-label">Name</div>\n        <div class="l-2-3"><input type="text" ng-model="category.title"/></div>\n    </div>\n    <div class="cf">\n        <div class="l-1-3 input-label">Image</div>\n        <div class="l-2-3">\n            <input ng-model="category.image" upload />\n        </div>\n    </div>\n</div>\n')}]),angular.module("testAdmin.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("testAdmin.html",'<div class="test-view">\n    <div class="cf">\n        <h1 class="float-left">{{title}}</h1>\n\n        <div class="float-right">\n            <button class="important" ng-click="submit()">Save</button>\n        </div>\n    </div>\n    <div class="cf">\n        <div class="cf">\n            <div class="l-1-3 input-label">Question</div>\n            <div class="l-2-3"><input type="text" ng-model="test.question"/></div>\n        </div>\n        <div class="cf" ng-repeat="answer in test.answers">\n            <div class="l-1-4 input-label">Answer {{$index + 1}}</div>\n            <div class="l-1-4"><input type="text" ng-model="answer.title"/></div>\n            <div class="l-1-4">\n                Correct?\n                <input type="radio" ng-model="$parent.correctOptionIndex" value="{{$index}}"/>\n            </div>\n            <div class="l-1-4">\n                Explanation\n                <input type="text" ng-model="answer.explanation"\n                       ng-disabled="$index == $parent.correctOptionIndex"/>\n            </div>\n        </div>\n    </div>\n</div>\n')}]),angular.module("testsAdmin.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("testsAdmin.html",'<div class="tests-view">\n    <div class="cf">\n        <h1 class="float-left">Tests for category {{category.title}}</h1>\n\n        <div class="float-right">\n            <button class="important" ng-click="add()">Add</button>\n        </div>\n    </div>\n    <div ng-if="!tests.length" class="msg-info">\n        There aren\'t tests on this category yet.\n        Click on the \'Add\' button to attach a new test to it.\n    </div>\n    <div class="test" ng-if="tests.length" ng-repeat="test in tests">\n        <div class="text float-left">\n            <div class="l-1-2" truncate>\n                {{test.question}}\n            </div>\n            <div class="l-1-2">\n                <div ng-repeat="answer in test.answers" truncate title="{{answer.title}}"\n                     ng-class="{ correct: answer.isCorrect }"\n                     class="answer l-1-{{test.answers.length}} t{{$index}}">\n                    {{answer.title}}\n                </div>\n            </div>\n        </div>\n        <div class="float-right">\n            <button>\n                <icon class="up-icon"></icon>\n            </button>\n            <button>\n                <icon class="down-icon"></icon>\n            </button>\n            <button ng-click="edit(test)">Edit</button>\n            <button class="delete" ng-click="confirmDelete(test)">Delete</button>\n        </div>\n    </div>\n    <div dialog mz-if="testToBeDeleted" title="Delete test">\n        <label class="warning">Warning</label><br/>\n        The following test will be deleted<br/><br/>\n        <b>{{testToBeDeleted.question}}</b><br/><br/>\n        <button class="delete" ng-click="delete()">Delete</button>\n    </div>\n</div>\n')}]),angular.module("tenant.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("tenant.html",'<div class="tenant-view">\n    <div class="cf">\n        <h1 class="float-left">{{title}}</h1>\n        <div class="float-right">\n            <button ng-click="submit()" class="important">Save</button>\n        </div>\n    </div>\n    <div class="cf">\n        <div class="l-1-3 input-label">Name</div>\n        <div class="l-2-3"><input type="text" ng-model="tenant.name"/></div>\n    </div>\n    <div class="cf">\n        <div class="l-1-3 input-label">Categories</div>\n        <div class="l-2-3">\n            <div auto-complete\n                 ng-model="tenant.categories"\n                 endpoint="/rest/categories"\n                 display-property="title">\n             </div>\n        </div>\n    </div>\n    <div class="cf">\n        <div class="l-1-3 input-label">Image</div>\n        <div class="l-2-3">\n            <input ng-model="tenant.image" upload />\n        </div>\n    </div>\n</div>')}]),angular.module("tenants.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("tenants.html",'<div class="tenants-view">\n    <div class="cf">\n        <h1 class="float-left">Manage tenants</h1>\n        <div class="float-right">\n            <button class="important" ng-click="add()">Add</button>\n        </div>\n    </div>\n    <div class="tenant" ng-repeat="tenant in tenants">\n        <div class="float-left">\n            {{tenant.name}}\n        </div>\n        <div class="float-right">\n            <button>\n                <icon class="up-icon"></icon>\n            </button>\n            <button>\n                <icon class="down-icon"></icon>\n            </button>\n            <button ng-click="edit(tenant)">Edit</button>\n            <button class="delete" ng-click="confirmDelete(tenant)">Delete</button>\n        </div>\n    </div>\n    <div dialog mz-if="tenantToBeDeleted" title="Delete tenant">\n        <label class="warning">Warning</label><br/>\n        The following tenants will be deleted<br/><br/>\n        <b>{{tenantToBeDeleted.title}}</b><br/><br/>\n        <button class="delete" ng-click="delete()">Delete</button>\n    </div>\n</div>\n')}]),angular.module("userAdmin.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("userAdmin.html",'<div class="user-view">\n    <div class="cf">\n        <h1 class="float-left">{{title}}</h1>\n        <div class="float-right">\n            <button class="important" ng-click="submit()">Save</button>\n        </div>\n    </div>\n    <div class="cf">\n        <div class="l-1-3 input-label">Username</div>\n        <div class="l-2-3"><input type="text" ng-model="user.userName"/></div>\n    </div>\n    <div class="cf">\n        <div class="l-1-3 input-label">Password</div>\n        <div class="l-2-3">\n            <a href="#"\n               ng-if="showForceChangePasswordLink"\n               ng-click="forceChangePassword()"\n               class="input-label text-align-left display-inline-block">\n                Change\n            </a>\n            <input type="password" ng-if="!showForceChangePasswordLink" ng-model="user.password"/>\n        </div>\n    </div>\n    <div class="cf">\n        <div class="l-1-3 input-label">Role</div>\n        <div class="l-2-3">\n            <select ng-model="user.role" ng-options="role._id as role.name for role in roles"></select>\n        </div>\n    </div>\n    <div class="cf">\n        <div class="l-1-3 input-label">Tenant</div>\n        <div class="l-2-3">\n            <div auto-complete\n                 ng-model="user.tenantId"\n                 endpoint="/rest/tenants"\n                 display-property="name"\n                 single-selection="true">\n            </div>\n        </div>\n    </div>\n</div>\n')}]),angular.module("usersAdmin.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("usersAdmin.html",'<div class="users-view">\n    <div class="cf">\n        <h1 class="float-left">Manage users</h1>\n        <div class="float-right">\n            <button class="important" ng-click="add()">Add</button>\n        </div>\n    </div>\n    <div class="user" ng-repeat="user in users">\n        <div class="float-left v-centered">\n            {{user.userName}}\n        </div>\n        <div class="float-right">\n            <button>\n                <icon class="up-icon"></icon>\n            </button>\n            <button>\n                <icon class="down-icon"></icon>\n            </button>\n            <button ng-click="edit(user)">Edit</button>\n            <button class="delete" ng-click="confirmDelete(user)">Delete</button>\n        </div>\n    </div>\n    <div dialog mz-if="userToBeDeleted" title="Delete user">\n        <label class="warning">Warning</label><br/>\n        The following user will be deleted<br/><br/>\n        <b>{{userToBeDeleted.userName}}</b><br/><br/>\n        <button class="delete" ng-click="delete()">Delete</button>\n    </div>\n</div>\n')}]),angular.module("app.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("app.html",'<div menu></div>\n<div ui-view ng-class="getRootStyleClasses()"></div>')}]),angular.module("categories.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("categories.html",'<div class="categories-view">\n    <h1>Select category</h1>\n    <div class="category l-1-3" ng-repeat="category in categories" truncate\n         ng-click="launchTest(category)">\n        <div class="image">\n            <img ng-src="{{category.image}}" />\n        </div>\n        <div class="title">{{category.title}}</div>\n    </div>\n</div>')}]),angular.module("autoComplete.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("autoComplete.html",'<tags-input\n        ng-model="tags"\n        display-property="{{displayProperty}}"\n        max-tags="{{maxTags}}"\n        on-tag-added="onTagAdded($tag)"\n        placeholder="{{placeholder}}"\n        ng-class="{ \'single-selection\': singleSelection }">\n    <auto-complete\n        source="source($query)"\n        min-length="1"\n        load-on-down-arrow="true">\n    </auto-complete>\n</tags-input>')}]),angular.module("dialog.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("dialog.html",'<div class="dialog" ng-if="mzIf">\n    <div class="overlay" ng-click="hideDialog()"></div>\n    <div class="box" centered ng-style="centerBox()">\n        <div class="header">\n            <h2 class="title">{{title}}</h2>\n            <button ng-click="hideDialog()"><icon class="close-icon"></icon></button>\n        </div>\n        <div ng-transclude class="content"></div>\n    </div>\n</div>')}]),angular.module("upload.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("upload.html",'<div class="upload-view">\n    <input type="file" />\n    <button class="addImage" ng-click="addImage()">Select</button>\n    <div class="output" ng-if="ngModel">\n        <button class="deleteImage" ng-click="delete()">\n            <icon class="close-icon"></icon>\n        </button>\n        <img ng-src="{{ngModel}}" />\n    </div>\n</div>')}]),angular.module("menu.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("menu.html",'<div class="menu-view">\n    <button class="admin" ng-click="showAdminOptions()" ng-if="hasAdminRole()"\n            ng-class="isActiveAction()">\n        Admin\n    </button>\n    <div ng-include="\'testData.html\'" ng-controller="TestDataCtrl"></div>\n    <button class="login" ng-click="showLoginDialog()" ng-if="!session">Login</button>\n    <button class="logout" ng-click="logout()" ng-if="session">Logout</button>\n    <div dialog title="Login" mz-if="showLogin">\n        <form ng-submit="login()">\n            <input class="user" ng-model="credentials.userName" type="text"\n                   placeholder="Username" autofocus/>\n            <input class="password" ng-model="credentials.password" type="password"\n                   placeholder="Password"/>\n            <button class="important">Login</button>\n        </form>\n    </div>\n</div>\n')}]),angular.module("testData.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("testData.html",'<div class="test-data-view" ng-if="testData">\n    <div class="metadata question">\n        <div class="title">Question</div>\n        <div class="value">\n            {{getCurrentQuestion()}} / {{testData.totalQuestions}}\n        </div>\n    </div>\n    <div class="total-progress">\n        <div class="runned-progress" ng-style="setProgressWidth()"></div>\n    </div>\n    <div class="metadata score">\n        <div class="title">Score</div>\n        <div class="value">{{score}}</div>\n    </div>\n</div>')}]),angular.module("questions.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("questions.html",'<div class="question">{{question.question}}</div>\n<div ng-if="isTestComplete">FINISH!!!</div>\n<div class="answers-container">\n    <div ng-repeat="answer in question.answers"\n         class="answer l-answer-{{question.answers.length}}"\n         ng-class="{ \'valid-assert\': answer.validAssert, \'invalid-assert\': answer.invalidAssert }"\n         ng-click="setAnswer(answer)">\n        <div class="option"><div class="text">{{answerCodes[$index]}}</div></div>\n        <div ng-if="answer.validAssert || answer.invalidAssert" class="assert-mark">\n            <icon ng-class="{ \'ok-icon\': answer.validAssert,  \'fail-icon\': answer.invalidAssert }"></icon>\n        </div>\n        <div class="title">{{answer.title}}</div>\n        <div class="explanation">{{answer.explanation}}</div>\n    </div>\n</div>')}]),angular.module("results.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("results.html",'<div class="results-view">\n    <div class="current-score">\n        <div class="title">Your score is</div>\n        <div class="value">{{score}}</div>\n    </div>\n    <div class="best-results" ng-if="showBestResults">\n        <h2 class="title">Best results on this test</h2>\n        <div class="scrolling-area">\n            <div class="best-result" ng-repeat="bestResult in bestResults"\n                 ng-class="{ current: isCurrentBestResult(bestResult) }">\n                <div class="position">{{$index + 1}}</div>\n                <div class="userName">{{bestResult.user.userName}}</div>\n                <div class="score">{{bestResult.score}}</div>\n            </div>\n        </div>\n    </div>\n    <div class="actions" ng-if="showBestResults">\n        <button ng-click="repeatTest()" class="important">Repeat again</button>\n        <button ng-click="goToHome()">Go to home</button>\n    </div>\n</div>')}]),angular.module("test.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("test.html",'<div class="test-view">\n    <div class="fade-animation" ng-show="isTestInProgress" ng-controller="QuestionsCtrl"\n         ng-include="\'questions.html\'" ng-animate></div>\n    <div class="fade-animation" ng-show="isTestFinished" ng-controller="ResultsCtrl"\n         ng-include="\'results.html\'" ng-animate></div>\n</div>')}]),angular.module("index.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("index.html",'<html ng-app="menzit">\n\n    <head>\n        <script src="/src/loader.js" type="text/javascript"></script>\n    </head>\n\n    <body>\n        <div ui-view></div>\n    </body>\n\n</html>')}]),angular.module("home.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("home.html",'<div class="home-view">\n    <div class="header">\n        <img class="logo" src="/src/portal/logo.svg" />\n    </div>\n    <div class="content">\n        <div class="main">\n            <div class="title">\n                <h1>Learn never have been so easy...</h1>\n            </div>\n            <div class="media">\n                <img src="/src/portal/home/main.png" />\n            </div>\n            <div class="action">\n                <button class="important" ui-sref="app.categories">Play!</button>\n            </div>\n        </div>\n        <div class="secondary">\n            <div class="l-1-2">\n                <h1>Learn</h1>\n                Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus ut orci a nunc convallis pretium at nec eros.\n            </div>\n            <div class="l-1-2">\n                <h1>Play!</h1>\n                Ut ac arcu dui. Ut cursus tempus eros in aliquet. Morbi vitae adipiscing mauris. Sed gravida accumsan suscipit.\n                http://www.shutterstock.com/g/00nl/sets/143661-characters-color-spots?page=1\n            </div>\n        </div>\n    </div>\n    <div class="footer">Copyright Â© 2015 menzit. All rights reserved.</div>\n</div>')}]),angular.module("portal.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("portal.html","<div ui-view></div>")}]),menzit.controller("PortalCtrl",[function(){}]),portal.controller("HomeCtrl",[function(){}]),menzit.controller("AppCtrl",["$rootScope","$scope","$state",function($rootScope,$scope,$state){function setCurrentStateStyleClasses(currentState){stateName=currentState.name.replace(/\./g,"-"),stateGroupId=currentState.data?currentState.data.groupId.replace(/\./g,"-"):""}var stateName,stateGroupId;setCurrentStateStyleClasses($state.current),$rootScope.$on("$stateChangeSuccess",function(e,toState){setCurrentStateStyleClasses(toState)}),$scope.getRootStyleClasses=function(){var rootStyleClasses={};return rootStyleClasses.root=!0,rootStyleClasses[stateName]=!0,rootStyleClasses[stateGroupId]=!0,rootStyleClasses}}]),app.controller("AdminCtrl",["$scope","$state",function($scope,$state){$scope.menuActions=[{label:"General",icon:"settings-general-icon",uiSref:"app.admin.tenants",subGroupId:"tenants"},{label:"Tests",icon:"settings-tests-icon",uiSref:"app.admin.categories",subGroupId:"categories"},{label:"Users",icon:"settings-users-icon",uiSref:"app.admin.users",subGroupId:"users"}],$scope.isActiveAction=function(targetState){return{active:targetState===$state.current.data.subGroupId}}}]),app.controller("CategoriesAdminCtrl",["$scope","$state","http",function($scope,$state,http){function loadCategories(){http.get("/rest/categories").then(function(response){$scope.categories=response})}loadCategories(),$scope.add=function(){$state.go("app.admin.addCategory")},$scope.edit=function(category){$state.go("app.admin.editCategory",{categoryId:category._id})},$scope.viewTests=function(category){$state.go("app.admin.tests",{categoryId:category._id})},$scope.confirmDelete=function(category){$scope.categoryToBeDeleted=category},$scope.delete=function(){http.delete("/rest/categories/"+$scope.categoryToBeDeleted._id).then(function(){$scope.categoryToBeDeleted=null,loadCategories()})}}]),app.controller("CategoryAddAdminCtrl",["$scope","$state","http",function($scope,$state,http){$scope.title="Add category",$scope.category={tests:[]},$scope.submit=function(){http.post("/rest/categories/",$scope.category).then(function(){$state.go("app.admin.categories")})}}]),app.controller("CategoryEditAdminCtrl",["$scope","$state","http","category",function($scope,$state,http,category){$scope.title="Edit category",$scope.category=category,$scope.submit=function(){var categoryRestUrl="/rest/categories/"+$state.params.categoryId;http.put(categoryRestUrl,$scope.category).then(function(){$state.go("app.admin.categories")})}}]),app.config(function($stateProvider){$stateProvider.state("app.admin.categories",{url:"/categories",templateUrl:"categoriesAdmin.html",controller:"CategoriesAdminCtrl",data:{subGroupId:"categories"}}).state("app.admin.addCategory",{url:"/categories/add",templateUrl:"categoryAdmin.html",controller:"CategoryAddAdminCtrl",data:{subGroupId:"categories"}}).state("app.admin.editCategory",{url:"/categories/edit/:categoryId",templateUrl:"categoryAdmin.html",controller:"CategoryEditAdminCtrl",resolve:{category:["$stateParams","http",function($stateParams,http){return http.get("/rest/categories/"+$stateParams.categoryId)}]},data:{subGroupId:"categories"}})}),app.controller("TestAddAdminCtrl",["$scope","$state","http","testAdmin",function($scope,$state,http,testAdmin){console.log("ALL THE TEST STUFF SHOULD BE RENAMED TO QUESTION"),$scope.title="Add test",$scope.correctOptionIndex=0,$scope.test={categoryId:$state.params.categoryId,answers:[{},{},{},{}]},$scope.submit=function(){$scope.test.answers=testAdmin.getNormalizedOutputAnswers($scope.test.answers),angular.forEach($scope.test.answers,function(answer,$index){answer.isCorrect=$index===Number($scope.correctOptionIndex)}),http.post("/rest/tests/",$scope.test).then(function(){$state.go("app.admin.tests",{categoryId:$state.params.categoryId})})}}]),app.controller("TestEditAdminCtrl",["$scope","$state","http","test","testAdmin",function($scope,$state,http,test,testAdmin){$scope.title="Edit test",$scope.test=test,$scope.test.answers=testAdmin.getNormalizedInputAnswers($scope.test.answers),angular.forEach($scope.test.answers,function(answer,$index){answer.isCorrect&&($scope.correctOptionIndex=$index)}),$scope.submit=function(){var testRestUrl="/rest/tests/"+$state.params.testId;$scope.test.answers=testAdmin.getNormalizedOutputAnswers($scope.test.answers),angular.forEach($scope.test.answers,function(answer,$index){answer.isCorrect=$index===Number($scope.correctOptionIndex)}),http.put(testRestUrl,$scope.test).then(function(){$state.go("app.admin.tests",{categoryId:$state.params.categoryId})})}}]),app.controller("TestsAdminCtrl",["$scope","$state","http","category",function($scope,$state,http,category){function loadTests(){var endpoint="/rest/tests?categoryId="+$state.params.categoryId;http.get(endpoint).then(function(tests){$scope.tests=tests})}loadTests(),$scope.category=category,$scope.add=function(){$state.go("app.admin.addTest",{categoryId:$state.params.categoryId})},$scope.edit=function(test){$state.go("app.admin.editTest",{testId:test._id,categoryId:$state.params.categoryId})},$scope.confirmDelete=function(test){$scope.testToBeDeleted=test},$scope.delete=function(){http.delete("/rest/tests/"+$scope.testToBeDeleted._id).then(function(){$scope.testToBeDeleted=null,loadTests()})}}]),app.factory("testAdmin",[function(){function getNormalizedInputAnswers(answers){for(var maxAnswers=4,i=answers.length;maxAnswers>i;i++)answers.push({});return answers}function getNormalizedOutputAnswers(answers){var normalizedAnswers=[];return angular.forEach(answers,function(answer){answer.title&&normalizedAnswers.push(answer)}),normalizedAnswers}return{getNormalizedInputAnswers:getNormalizedInputAnswers,getNormalizedOutputAnswers:getNormalizedOutputAnswers}}]),app.config(function($stateProvider){$stateProvider.state("app.admin.tests",{url:"/categories/:categoryId/tests",templateUrl:"testsAdmin.html",controller:"TestsAdminCtrl",resolve:{category:["$stateParams","http",function($stateParams,http){return http.get("/rest/categories/"+$stateParams.categoryId)}]},data:{subGroupId:"categories"}}).state("app.admin.addTest",{url:"/categories/:categoryId/tests/add",templateUrl:"testAdmin.html",controller:"TestAddAdminCtrl",data:{subGroupId:"categories"}}).state("app.admin.editTest",{url:"/categories/:categoryId/tests/edit/:testId",templateUrl:"testAdmin.html",controller:"TestEditAdminCtrl",resolve:{test:["$stateParams","http",function($stateParams,http){return http.get("/rest/tests/"+$stateParams.testId)}]},data:{subGroupId:"categories"}})}),app.controller("TenantAddCtrl",["$scope","$state","http",function($scope,$state,http){$scope.title="Add tenant",$scope.submit=function(){http.post("/rest/tenants/",$scope.tenant).then(function(){$state.go("app.admin.tenants")})}}]),app.controller("TenantEditCtrl",["$scope","$state","$q","http","tenant",function($scope,$state,$q,http,tenant){$scope.title="Edit tenant",$scope.tenant=tenant,$scope.submit=function(){var tenantRestUrl="/rest/tenants/"+$state.params.tenantId;http.put(tenantRestUrl,$scope.tenant).then(function(){$state.go("app.admin.tenants")})}}]),app.controller("TenantsCtrl",["$rootScope","$scope","$state","http",function($rootScope,$scope,$state,http){function loadTenants(){http.get("/rest/tenants").then(function(response){$scope.tenants=response})}loadTenants(),$scope.add=function(){$state.go("app.admin.addTenant")},$scope.edit=function(tenant){$state.go("app.admin.editTenant",{tenantId:tenant._id})},$scope.confirmDelete=function(tenant){$scope.tenantToBeDeleted=tenant},$scope.delete=function(){http.delete("/rest/tenants/"+$scope.tenantToBeDeleted._id).then(function(){$scope.tenantToBeDeleted=null,loadTenants()})}}]),app.config(function($stateProvider){$stateProvider.state("app.admin.tenants",{url:"/tenants",templateUrl:"tenants.html",controller:"TenantsCtrl",data:{subGroupId:"tenants"}}).state("app.admin.addTenant",{url:"/tenants/add",templateUrl:"tenant.html",controller:"TenantAddCtrl",data:{subGroupId:"tenants"}}).state("app.admin.editTenant",{url:"/tenants/edit/:tenantId",templateUrl:"tenant.html",controller:"TenantEditCtrl",resolve:{tenant:["$stateParams","http",function($stateParams,http){return http.get("/rest/tenants/"+$stateParams.tenantId)}]},data:{subGroupId:"tenants"}})}),app.controller("UserAddAdminCtrl",["$scope","$state","http","constants",function($scope,$state,http,constants){$scope.title="Add user",$scope.roles=constants.roles,$scope.user={role:$scope.roles[0]._id},$scope.submit=function(){http.post("/rest/users/",$scope.user).then(function(){$state.go("app.admin.users")})}}]),app.controller("UserEditAdminCtrl",["$scope","$state","http","user","constants",function($scope,$state,http,user,constants){$scope.title="Edit user",$scope.user=user,$scope.roles=constants.roles,$scope.showForceChangePasswordLink=!0,$scope.submit=function(){http.put("/rest/users/"+$state.params.userId,$scope.user).then(function(){$state.go("app.admin.users")})},$scope.forceChangePassword=function(){$scope.showForceChangePasswordLink=!1}}]),app.controller("UsersAdminCtrl",["$scope","$state","http",function($scope,$state,http){function loadUsers(){http.get("/rest/users").then(function(response){$scope.users=response
})}loadUsers(),$scope.add=function(){$state.go("app.admin.addUser")},$scope.edit=function(user){$state.go("app.admin.editUser",{userId:user._id})},$scope.confirmDelete=function(user){$scope.userToBeDeleted=user},$scope.delete=function(){http.delete("/rest/users/"+$scope.userToBeDeleted._id).then(function(){$scope.userToBeDeleted=null,loadUsers()})}}]),app.config(function($stateProvider){$stateProvider.state("app.admin.users",{url:"/users",templateUrl:"usersAdmin.html",controller:"UsersAdminCtrl",data:{subGroupId:"users"}}).state("app.admin.addUser",{url:"/users/add",templateUrl:"userAdmin.html",controller:"UserAddAdminCtrl",data:{subGroupId:"users"}}).state("app.admin.editUser",{url:"/users/edit/:userId",templateUrl:"userAdmin.html",controller:"UserEditAdminCtrl",data:{subGroupId:"users"},resolve:{user:["$stateParams","http",function($stateParams,http){return http.get("/rest/users/"+$stateParams.userId)}]}})}),app.controller("CategoriesCtrl",["$scope","$state","http",function($scope,$state,http){http.get("/rest/categories").then(function(response){$scope.categories=response}),$scope.launchTest=function(category){$state.go("app.test",{categoryId:category._id})}}]),app.directive("autoComplete",["http",function(http){return{restrict:"A",templateUrl:"autoComplete.html",scope:{ngModel:"=",endpoint:"@",displayProperty:"@",singleSelection:"="},link:function(scope){function fillTagsInfo(ngModel,endpoint,displayProperty){scope.singleSelection?fillTagInfo(endpoint,ngModel,displayProperty,0):ngModel.forEach(function(tagId,$index){fillTagInfo(endpoint,tagId,displayProperty,$index)})}function updateSingleSelectionNgModel(tags){scope.ngModel=areThereTags(tags)?tags[0]._id:""}function updateMultiSelectionNgModel(tags){scope.ngModel.length=0,areThereTags(tags)&&tags.forEach(function(tag){scope.ngModel.push(tag._id)})}function areThereTags(tags){return tags&&tags.length}function fillTagInfo(endpoint,tagId,displayProperty,$index){http.get(endpoint+"/"+tagId).then(function(tag){scope.tags.push({_id:tagId}),scope.tags[$index][displayProperty]=tag[displayProperty]})}scope.tags=[],scope.maxTags=scope.singleSelection?1:null,scope.placeholder=" ",scope.ngModel?fillTagsInfo(scope.ngModel,scope.endpoint,scope.displayProperty):scope.ngModel=scope.singleSelection?"":[],scope.source=function($query){return http.get(scope.endpoint+"?search="+$query)},scope.onTagAdded=function($tag){scope.singleSelection&&(scope.tags.length=0,scope.tags.push($tag))},scope.$watch("tags",function(tags){scope.singleSelection?updateSingleSelectionNgModel(tags):updateMultiSelectionNgModel(tags)},!0)}}}]),function(){app.directive("dialog",[function(){return{replace:!0,restrict:"A",transclude:!0,scope:{title:"@",mzIf:"="},templateUrl:"dialog.html",link:function(scope){scope.hideDialog=function(){scope.mzIf=!1},angular.element(document).bind("keyup",function(e){27===e.keyCode&&(scope.hideDialog(),scope.$apply())})}}}]),app.directive("centered",[function(){return{restrict:"A",link:function(scope,element){var elementHeight=element.outerHeight(),elementWidth=element.outerWidth();scope.centerBox=function(){return{marginTop:-(elementHeight/2),marginLeft:-(elementWidth/2)}}}}}])}(),app.directive("title",[function(){return{link:function(scope,element,attrs){element.data("powertip",attrs.title),element.powerTip({})}}}]),app.directive("truncate",["$timeout",function($timeout){return{link:function(scope,element){$timeout(function(){element.dotdotdot({watch:"window"})})}}}]),app.directive("upload",[function(){return{replace:!0,restrict:"A",templateUrl:"upload.html",scope:{ngModel:"="},link:function(scope,element){function handleFileSelect(evt){var reader,file=evt.target.files[0];file.type.match("image.*")&&(reader=new FileReader,reader.onload=function(){return function(e){scope.ngModel=e.target.result,scope.$apply()}}(),reader.readAsDataURL(file))}scope.addImage=function(){inputElement.click()},scope.delete=function(){scope.ngModel=null,inputElement.val("")};var inputElement=angular.element('input[type="file"]',element);inputElement.bind("change",handleFileSelect)}}}]),function(){app.directive("menu",["$rootScope","$state","session",function($rootScope,$state,session){return{replace:!0,restrict:"A",templateUrl:"menu.html",link:function(scope){session.getSession().then(function(session){scope.session=session}),scope.hasAdminRole=function(){return session.hasAdminRole()},scope.showAdminOptions=function(){$state.go("app.admin.tenants")},scope.showLoginDialog=function(){scope.credentials={},scope.showLogin=!0},scope.login=function(){var userName=scope.credentials.userName,password=scope.credentials.password;session.login(userName,password).then(function(session){session?($rootScope.$emit("authenticatedUser",session),scope.session=session,scope.showLogin=!1):window.alert("LOGIN INCORRECTO")})},scope.logout=function(){session.logout().then(function(){scope.session=void 0,$state.go("app.categories")})},scope.isActiveAction=function(){var stateData=$state.current.data;return{active:stateData&&"admin"===stateData.groupId}}}}}])}(),function(){app.controller("TestDataCtrl",["$scope","$interval","pubSub",function($scope,$interval,pubSub){var scoreUpdatedSub,updateScoreIntervalFn;$scope.score=0,$scope.setProgressWidth=function(){return $scope.testData?{width:$scope.testData.runnedQuestions/$scope.testData.totalQuestions*100+"%"}:null},scoreUpdatedSub=pubSub.subscribe("scoreUpdated",function(msg,data){$scope.testData=data,$scope.$apply(),updateScoreIntervalFn=$interval(function(){$scope.score<$scope.testData.score?$scope.score+=1:$interval.cancel(updateScoreIntervalFn)},5)}),$scope.getCurrentQuestion=function(){return $scope.testData.runnedQuestions<$scope.testData.totalQuestions?$scope.testData.runnedQuestions+1:$scope.testData.runnedQuestions},$scope.$on("$destroy",function(){$interval.cancel(updateScoreIntervalFn),pubSub.unsubscribe(scoreUpdatedSub)})}])}(),app.controller("TestCtrl",["$scope","$timeout","pubSub",function($scope,$timeout,pubSub){function finishTest(){$timeout(function(){$scope.isTestInProgress=!1,$timeout(function(){$scope.isTestFinished=!0},1e3)},1500)}$scope.isTestInProgress=!0;var scoreUpdatedSub=pubSub.subscribe("scoreUpdated",function(msg,data){data.runnedQuestions===data.totalQuestions&&finishTest()});$scope.$on("$destroy",function(){pubSub.unsubscribe(scoreUpdatedSub)})}]),app.controller("QuestionsCtrl",["$scope","$timeout","$state","http","pubSub",function($scope,$timeout,$state,http,pubSub){function setCorrectAnswer(answer){$scope.isCorrectAnswer=!0,answer.validAssert=!0,setScore(),isLastQuestion()?$scope.isTestComplete=!0:$timeout(function(){$scope.getNextTest()},1e3)}function setIncorrectAnswer(answer){answer.invalidAssert=answer.invalidAssert?!1:!answer.isCorrect,failedAnswers<$scope.question.answers.length-1&&failedAnswers++}function setCurrentTest(){var questionId=getQuestionId();runnedQuestions.push(questionId),failedAnswers=0,$scope.question=availableQuestions[questionId]}function getQuestionId(){var proposedQuestionIndex;do proposedQuestionIndex=parseInt(Math.random()*availableQuestions.length);while(runnedQuestions.indexOf(proposedQuestionIndex)>=0);return proposedQuestionIndex}function isLastQuestion(){return runnedQuestions.length===availableQuestions.length}function setScore(){var maxQuestionScore=100;void 0===$scope.score?$scope.score=0:$scope.score+=maxQuestionScore-failedAnswers*Math.ceil(maxQuestionScore/$scope.question.answers.length),sendScoreEvent()}function sendScoreEvent(){pubSub.publish("scoreUpdated",{score:$scope.score,runnedQuestions:runnedQuestions.length,totalQuestions:availableQuestions.length})}var failedAnswers,availableQuestions=[],runnedQuestions=[];http.get("/rest/tests?categoryId="+$state.params.categoryId).then(function(questions){availableQuestions=questions,setScore(),setCurrentTest()}),$scope.answerCodes=["A","B","C","D"],$scope.setAnswer=function(answer){answer.isCorrect?setCorrectAnswer(answer):setIncorrectAnswer(answer)},$scope.getNextTest=function(){setCurrentTest(),$scope.isCorrectAnswer=!1}}]),app.controller("ResultsCtrl",["$scope","$state","$timeout","$interval","$q","$stateParams","http","pubSub",function($scope,$state,$timeout,$interval,$q,$stateParams,http,pubSub){function finishTest(score){displayResult(score),saveScore(score).then(loadBestResults)}function loadBestResults(){http.get("/rest/scores?categoryId="+$state.params.categoryId).then(function(bestResults){$scope.bestResults=bestResults})}function displayResult(score){$timeout(function(){$scope.score=0,updateScoreIntervalFn=$interval(function(){$scope.score<score?$scope.score+=1:($interval.cancel(updateScoreIntervalFn),$timeout(function(){$scope.showBestResults=!0},3e3))},5)},3500)}function saveScore(score){var deferred=$q.defer();return http.post("/rest/scores/",{score:score,categoryId:$state.params.categoryId}).then(function(savedScore){currentResult=savedScore,deferred.resolve(savedScore)}),deferred.promise}var scoreUpdatedSub,updateScoreIntervalFn,currentResult;scoreUpdatedSub=pubSub.subscribe("scoreUpdated",function(msg,data){data.runnedQuestions===data.totalQuestions&&finishTest(data.score)}),$scope.$on("$destroy",function(){pubSub.unsubscribe(scoreUpdatedSub)}),$scope.isCurrentBestResult=function(bestResult){return bestResult._id===currentResult._id},$scope.repeatTest=function(){$state.transitionTo($state.current,$stateParams,{reload:!0,inherit:!1,notify:!0})},$scope.goToHome=function(){$state.go("app.categories")}}]);